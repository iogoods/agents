{"version":3,"sources":["../src/error/base.ts","../src/error/data.ts","../src/environment.ts","../src/utils/priceFeedsValidation.ts","../src/actions/actionGetPriceFeeds.ts","../src/utils/priceUpdateStreamValidation.ts","../src/actions/actionGetPriceUpdatesStream.ts","../src/actions/actionGetLatestPriceUpdates.ts","../src/utils/priceUpdatesValidation.ts","../src/utils/publisherCapsValidation.ts","../src/actions/actionGetLatestPublisherCaps.ts","../src/index.ts"],"names":["PythError","code","message","severity","details","originalError","DataError","_DataError","subscription","reason","currentCount","maxLimit","data","validationErrors","expected","received","targetFormat","error","schema","symbol","lastUpdateTime","maxAge","chain","operation","ENV","PYTH_NETWORKS","pythEnvSchema","z","getConfig","env","validatePythConfig","runtime","envConfig","config","errorMessage","getNetworkConfig","priceFeedAttributesSchema","priceFeedsSchema","validatePriceFeedsData","content","result","elizaLogger","GRANULAR_LOG","logGranular","getPriceFeedsAction","state","_options","callback","messageContent","query","filter","networkConfig","client","HermesClient","options","priceFeeds","transformedFeeds","feed","callbackContent","errorStack","errorContent","actionGetPriceFeeds_default","streamOptionsSchema","priceMetadataSchema","priceDataSchema","parsedPriceUpdateSchema","binaryDataSchema","priceUpdateStreamSchema","validatePriceUpdateStreamData","PYTH_MAX_PRICE_STREAMS","activeStreams","extractPriceIds","text","priceIds","symbolMatch","symbolToId","id","hexMatchesWithPrefix","hexMatches","processPriceUpdateData","item","formatPriceUpdateText","streamId","messageCount","collectStreamData","eventSource","resolve","reject","collectedData","event","rawData","createPriceStream","processedData","updateText","getPriceUpdatesStreamAction","_runtime","index","encoding","parsed","allowUnordered","benchmarksOnly","actionGetPriceUpdatesStream_default","ajv","Ajv","priceUpdatesSchema","validatePriceUpdatesData","validate","errors","err","normalizePriceFeedId","formatPriceFeedId","getLatestPriceUpdatesAction","match","cleanId","_state","hermesClient","updates","formattedText","update","metadata","proofTime","actionGetLatestPriceUpdates_default","publisherCapsSchema","validatePublisherCapsData","getLatestPublisherCapsAction","response","publisherCaps","currentTimestamp","cap","actionGetLatestPublisherCaps_default","spinner","ora","chalk","actions","actionTable","Table","action","statusTable","pythDataPlugin","index_default"],"mappings":"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","file":"index.js","sourcesContent":["// Base error codes\r\nexport enum PythErrorCode {\r\n  // WebSocket connection errors\r\n  WS_CONNECTION_TIMEOUT = 'WS_CONNECTION_TIMEOUT',\r\n  WS_CONNECTION_REFUSED = 'WS_CONNECTION_REFUSED',\r\n  WS_INVALID_URL = 'WS_INVALID_URL',\r\n  WS_HEARTBEAT_FAILED = 'WS_HEARTBEAT_FAILED',\r\n  WS_SSL_ERROR = 'WS_SSL_ERROR',\r\n  WS_INVALID_STATE_TRANSITION = 'WS_INVALID_STATE_TRANSITION',\r\n  WS_MESSAGE_PARSE_ERROR = 'WS_MESSAGE_PARSE_ERROR',\r\n  WS_RATE_LIMIT_EXCEEDED = 'WS_RATE_LIMIT_EXCEEDED',\r\n  WS_INVALID_MESSAGE_FORMAT = 'WS_INVALID_MESSAGE_FORMAT',\r\n\r\n  // Runtime errors\r\n  RUNTIME_INITIALIZATION = 'RUNTIME_INITIALIZATION',\r\n  RUNTIME_CONFIGURATION = 'RUNTIME_CONFIGURATION',\r\n  RUNTIME_VALIDATION = 'RUNTIME_VALIDATION',\r\n\r\n  // State management errors\r\n  STATE_INVALID_TRANSITION = 'STATE_INVALID_TRANSITION',\r\n  STATE_PERSISTENCE = 'STATE_PERSISTENCE',\r\n  STATE_UNEXPECTED_DISCONNECT = 'STATE_UNEXPECTED_DISCONNECT',\r\n  STATE_RECONNECTION_FAILED = 'STATE_RECONNECTION_FAILED',\r\n  STATE_MAX_RECONNECT_EXCEEDED = 'STATE_MAX_RECONNECT_EXCEEDED',\r\n\r\n  // Data handling errors\r\n  DATA_INVALID_SUBSCRIPTION = 'DATA_INVALID_SUBSCRIPTION',\r\n  DATA_SUBSCRIPTION_LIMIT = 'DATA_SUBSCRIPTION_LIMIT',\r\n  DATA_VALIDATION_FAILED = 'DATA_VALIDATION_FAILED',\r\n  DATA_SEQUENCE_ERROR = 'DATA_SEQUENCE_ERROR',\r\n  DATA_TRANSFORM_ERROR = 'DATA_TRANSFORM_ERROR',\r\n  DATA_SCHEMA_ERROR = 'DATA_SCHEMA_ERROR',\r\n  DATA_STALE_PRICE = 'DATA_STALE_PRICE',\r\n  DATA_CHAIN_ERROR = 'DATA_CHAIN_ERROR',\r\n  DATA_PARSE_ERROR = 'DATA_PARSE_ERROR',\r\n  DATA_PRICE_UNAVAILABLE = 'DATA_PRICE_UNAVAILABLE',\r\n  DATA_CONFIDENCE_TOO_LOW = 'DATA_CONFIDENCE_TOO_LOW',\r\n  DATA_CONTRACT_ERROR = 'DATA_CONTRACT_ERROR',\r\n\r\n  // Generic errors\r\n  UNKNOWN = 'UNKNOWN',\r\n  INTERNAL = 'INTERNAL',\r\n  NETWORK = 'NETWORK',\r\n  NETWORK_ERROR = 'NETWORK_ERROR',\r\n  TIMEOUT = 'TIMEOUT',\r\n  INVALID_PARAMETER = 'INVALID_PARAMETER',\r\n  SUBSCRIPTION_LIMIT_EXCEEDED = 'SUBSCRIPTION_LIMIT_EXCEEDED',\r\n  WEBSOCKET_ERROR = 'WEBSOCKET_ERROR',\r\n  MESSAGE_PROCESSING_ERROR = 'MESSAGE_PROCESSING_ERROR',\r\n  CONNECTION_FAILED = 'CONNECTION_FAILED',\r\n  HANDLER_FAILED = 'HANDLER_FAILED',\r\n\r\n  // Generic Errors\r\n  UNKNOWN_ERROR = 'UNKNOWN_ERROR'\r\n}\r\n\r\nexport enum ErrorSeverity {\r\n  LOW = 'LOW',         // Non-critical errors that don't affect core functionality\r\n  MEDIUM = 'MEDIUM',   // Errors that affect some functionality but system can continue\r\n  HIGH = 'HIGH',       // Critical errors that require immediate attention\r\n  FATAL = 'FATAL'      // System cannot continue operation\r\n}\r\n\r\n// Error detail types\r\nexport interface ErrorDetails {\r\n  [key: string]: unknown;\r\n}\r\n\r\n// Extended error interface\r\nexport interface IPythError {\r\n  code: PythErrorCode;\r\n  message: string;\r\n  severity: ErrorSeverity;\r\n  timestamp: number;\r\n  details?: ErrorDetails;\r\n  originalError?: Error;\r\n  name: string;\r\n}\r\n\r\n// Base Pyth error class\r\nexport class PythError extends Error implements IPythError {\r\n  public readonly timestamp: number;\r\n  public readonly name: string = 'PythError';\r\n\r\n  constructor(\r\n    public readonly code: PythErrorCode,\r\n    public readonly message: string,\r\n    public readonly severity: ErrorSeverity = ErrorSeverity.MEDIUM,\r\n    public readonly details?: ErrorDetails,\r\n    public readonly originalError?: Error\r\n  ) {\r\n    super(message);\r\n    this.timestamp = Date.now();\r\n    Object.setPrototypeOf(this, new.target.prototype);\r\n  }\r\n\r\n  toJSON(): object {\r\n    return {\r\n      name: this.name,\r\n      code: this.code,\r\n      message: this.message,\r\n      severity: this.severity,\r\n      timestamp: this.timestamp,\r\n      details: this.details,\r\n      stack: this.stack,\r\n      originalError: this.originalError ? {\r\n        name: this.originalError.name,\r\n        message: this.originalError.message,\r\n        stack: this.originalError.stack\r\n      } : undefined\r\n    };\r\n  }\r\n}\r\n\r\n// Error utility functions\r\nexport const createError = (\r\n  code: PythErrorCode,\r\n  message: string,\r\n  severity?: ErrorSeverity,\r\n  details?: ErrorDetails,\r\n  originalError?: Error\r\n): PythError => {\r\n  return new PythError(code, message, severity, details, originalError);\r\n}; ","import { PythError, ErrorSeverity, type PythErrorCode, type ErrorDetails } from './base';\r\n\r\n// Data Error Codes\r\nexport enum DataErrorCode {\r\n  // Validation Errors\r\n  VALIDATION_FAILED = 'DATA_VALIDATION_FAILED',\r\n  INVALID_SUBSCRIPTION = 'DATA_INVALID_SUBSCRIPTION',\r\n  SUBSCRIPTION_LIMIT = 'DATA_SUBSCRIPTION_LIMIT',\r\n  SCHEMA_ERROR = 'DATA_SCHEMA_ERROR',\r\n\r\n  // Processing Errors\r\n  SEQUENCE_ERROR = 'DATA_SEQUENCE_ERROR',\r\n  TRANSFORM_ERROR = 'DATA_TRANSFORM_ERROR',\r\n  PARSE_ERROR = 'DATA_PARSE_ERROR',\r\n\r\n  // Price Feed Errors\r\n  PRICE_UNAVAILABLE = 'DATA_PRICE_UNAVAILABLE',\r\n  CONFIDENCE_TOO_LOW = 'DATA_CONFIDENCE_TOO_LOW',\r\n  STALE_PRICE = 'DATA_STALE_PRICE',\r\n\r\n  // Chain-Specific Errors\r\n  CHAIN_DATA_ERROR = 'DATA_CHAIN_ERROR',\r\n  CONTRACT_ERROR = 'DATA_CONTRACT_ERROR',\r\n\r\n  // Network and Connection Errors\r\n  NETWORK_ERROR = 'NETWORK_ERROR',\r\n  WEBSOCKET_ERROR = 'WEBSOCKET_ERROR',\r\n  MESSAGE_PROCESSING_ERROR = 'MESSAGE_PROCESSING_ERROR',\r\n  CONNECTION_FAILED = 'CONNECTION_FAILED',\r\n  HANDLER_FAILED = 'HANDLER_FAILED',\r\n  SUBSCRIPTION_LIMIT_EXCEEDED = 'SUBSCRIPTION_LIMIT_EXCEEDED',\r\n  PRICE_FEEDS_FETCH_FAILED = 'PRICE_FEEDS_FETCH_FAILED'\r\n}\r\n\r\n// Validation error type\r\ntype ValidationError = string | {\r\n  field: string;\r\n  message: string;\r\n  value?: unknown;\r\n};\r\n\r\nexport class DataError extends PythError {\r\n  public readonly name: string = 'DataError';\r\n\r\n  constructor(\r\n    code: PythErrorCode | DataErrorCode,\r\n    message: string,\r\n    severity: ErrorSeverity = ErrorSeverity.MEDIUM,\r\n    details?: ErrorDetails,\r\n    originalError?: Error\r\n  ) {\r\n    super(code as PythErrorCode, message, severity, details, originalError);\r\n    Object.setPrototypeOf(this, new.target.prototype);\r\n  }\r\n\r\n  // Factory methods\r\n  static invalidSubscription(subscription: unknown, reason: string): DataError {\r\n    return new DataError(\r\n      DataErrorCode.INVALID_SUBSCRIPTION,\r\n      'Invalid subscription parameters',\r\n      ErrorSeverity.MEDIUM,\r\n      { subscription, reason }\r\n    );\r\n  }\r\n\r\n  static subscriptionLimitExceeded(\r\n    currentCount: number,\r\n    maxLimit: number\r\n  ): DataError {\r\n    return new DataError(\r\n      DataErrorCode.SUBSCRIPTION_LIMIT,\r\n      `Subscription limit exceeded (${currentCount}/${maxLimit})`,\r\n      ErrorSeverity.HIGH,\r\n      { currentCount, maxLimit }\r\n    );\r\n  }\r\n\r\n  static validationFailed(\r\n    data: unknown,\r\n    validationErrors: ValidationError[]\r\n  ): DataError {\r\n    return new DataError(\r\n      DataErrorCode.VALIDATION_FAILED,\r\n      'Data validation failed',\r\n      ErrorSeverity.MEDIUM,\r\n      { data, validationErrors }\r\n    );\r\n  }\r\n\r\n  static sequenceError(\r\n    expected: number,\r\n    received: number,\r\n    details?: ErrorDetails\r\n  ): DataError {\r\n    return new DataError(\r\n      DataErrorCode.SEQUENCE_ERROR,\r\n      `Message sequence error: expected ${expected}, received ${received}`,\r\n      ErrorSeverity.MEDIUM,\r\n      { expected, received, ...details }\r\n    );\r\n  }\r\n\r\n  static transformError(data: unknown, targetFormat: string, error?: Error): DataError {\r\n    return new DataError(\r\n      DataErrorCode.TRANSFORM_ERROR,\r\n      'Failed to transform data',\r\n      ErrorSeverity.MEDIUM,\r\n      { data, targetFormat },\r\n      error\r\n    );\r\n  }\r\n\r\n  static schemaError(data: unknown, schema: Record<string, unknown>, error?: Error): DataError {\r\n    return new DataError(\r\n      DataErrorCode.SCHEMA_ERROR,\r\n      'Data does not match schema',\r\n      ErrorSeverity.HIGH,\r\n      { data, schema },\r\n      error\r\n    );\r\n  }\r\n\r\n  static stalePriceError(\r\n    symbol: string,\r\n    lastUpdateTime: number,\r\n    maxAge: number\r\n  ): DataError {\r\n    return new DataError(\r\n      DataErrorCode.STALE_PRICE,\r\n      `Price data for ${symbol} is stale`,\r\n      ErrorSeverity.HIGH,\r\n      {\r\n        symbol,\r\n        lastUpdateTime,\r\n        maxAge,\r\n        currentTime: Date.now()\r\n      }\r\n    );\r\n  }\r\n\r\n  static chainError(\r\n    chain: string,\r\n    operation: string,\r\n    error?: Error\r\n  ): DataError {\r\n    return new DataError(\r\n      DataErrorCode.CHAIN_DATA_ERROR,\r\n      `Chain-specific error on ${chain} during ${operation}`,\r\n      ErrorSeverity.HIGH,\r\n      { chain, operation },\r\n      error\r\n    );\r\n  }\r\n}\r\n\r\n// Type guard\r\nexport const isDataError = (error: unknown): error is DataError => {\r\n  return error instanceof DataError;\r\n};","import type { IAgentRuntime} from \"@elizaos/core\";\r\nimport { z } from \"zod\";\r\n\r\n// Environment Variables\r\nlet ENV = \"mainnet\";\r\n\r\n// Pyth Network Configuration\r\nconst PYTH_NETWORKS = {\r\n    mainnet: {\r\n        hermes: process.env.PYTH_MAINNET_HERMES_URL || \"https://hermes.pyth.network\",\r\n        wss: process.env.PYTH_MAINNET_WSS_URL || \"wss://hermes.pyth.network/ws\",\r\n        pythnet: process.env.PYTH_MAINNET_PYTHNET_URL || \"https://pythnet.rpcpool.com\",\r\n        contractRegistry: process.env.PYTH_MAINNET_CONTRACT_REGISTRY || \"https://pyth.network/developers/price-feed-ids\",\r\n        programKey: process.env.PYTH_MAINNET_PROGRAM_KEY || \"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH\"\r\n    },\r\n    testnet: {\r\n        hermes: process.env.PYTH_TESTNET_HERMES_URL || \"https://hermes.pyth.network\",\r\n        wss: process.env.PYTH_TESTNET_WSS_URL || \"wss://hermes.pyth.network/ws\",\r\n        pythnet: process.env.PYTH_TESTNET_PYTHNET_URL || \"https://pythnet.rpcpool.com\",\r\n        contractRegistry: process.env.PYTH_TESTNET_CONTRACT_REGISTRY || \"https://pyth.network/developers/price-feed-ids#testnet\",\r\n        programKey: process.env.PYTH_TESTNET_PROGRAM_KEY || \"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH\"\r\n    }\r\n} as const;\r\n\r\n// // Log environment information\r\n// elizaLogger.info(\"Environment sources\", {\r\n//     shellVars: Object.keys(process.env).filter(key => key.startsWith('PYTH_')),\r\n// });\r\n\r\nexport const pythEnvSchema = z.object({\r\n    PYTH_NETWORK_ENV: z.enum([\"mainnet\", \"testnet\"]).default(\"mainnet\"),\r\n    PYTH_MAX_RETRIES: z.string().transform(Number).default(\"3\"),\r\n    PYTH_RETRY_DELAY: z.string().transform(Number).default(\"1000\"),\r\n    PYTH_TIMEOUT: z.string().transform(Number).default(\"5000\"),\r\n    PYTH_GRANULAR_LOG: z.boolean().default(true),\r\n    PYTH_LOG_LEVEL: z.enum([\"error\", \"warn\", \"info\", \"debug\"]).default(\"info\"),\r\n    RUNTIME_CHECK_MODE: z.boolean().default(false),\r\n    PYTH_ENABLE_PRICE_STREAMING: z.boolean().default(true),\r\n    PYTH_MAX_PRICE_STREAMS: z.string().transform(Number).default(\"10\"),\r\n    PYTH_TEST_ID01: z.string().default(\"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"),\r\n    PYTH_TEST_ID02: z.string().default(\"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\"),\r\n\r\n});\r\n\r\nexport type PythConfig = z.infer<typeof pythEnvSchema>;\r\n\r\nexport function getConfig(\r\n    env: string | undefined | null = ENV ||\r\n        process.env.PYTH_NETWORK_ENV\r\n): PythConfig {\r\n    ENV = env || \"mainnet\";\r\n\r\n    return {\r\n        PYTH_NETWORK_ENV: (env as \"mainnet\" | \"testnet\") || \"mainnet\",\r\n        PYTH_MAX_RETRIES: Number(process.env.PYTH_MAX_RETRIES || \"3\"),\r\n        PYTH_RETRY_DELAY: Number(process.env.PYTH_RETRY_DELAY || \"1000\"),\r\n        PYTH_TIMEOUT: Number(process.env.PYTH_TIMEOUT || \"5000\"),\r\n        PYTH_GRANULAR_LOG: process.env.PYTH_GRANULAR_LOG === \"true\" || false,\r\n        PYTH_LOG_LEVEL: (process.env.PYTH_LOG_LEVEL as \"error\" | \"warn\" | \"info\" | \"debug\") || \"info\",\r\n        RUNTIME_CHECK_MODE: process.env.RUNTIME_CHECK_MODE === \"true\" || false,\r\n        PYTH_ENABLE_PRICE_STREAMING: process.env.PYTH_ENABLE_PRICE_STREAMING === \"true\" || true,\r\n        PYTH_MAX_PRICE_STREAMS: Number(process.env.PYTH_MAX_PRICE_STREAMS || \"10\"),\r\n        PYTH_TEST_ID01: process.env.PYTH_TEST_ID01 || \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n        PYTH_TEST_ID02: process.env.PYTH_TEST_ID02 || \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\r\n    };\r\n}\r\n\r\nexport async function validatePythConfig(\r\n    runtime: IAgentRuntime\r\n): Promise<PythConfig> {\r\n    try {\r\n        const envConfig = getConfig(\r\n            runtime.getSetting(\"PYTH_NETWORK_ENV\") ?? undefined\r\n        );\r\n\r\n        const config = {\r\n            PYTH_NETWORK_ENV: process.env.PYTH_NETWORK_ENV || runtime.getSetting(\"PYTH_NETWORK_ENV\") || envConfig.PYTH_NETWORK_ENV,\r\n            PYTH_MAX_RETRIES: process.env.PYTH_MAX_RETRIES || runtime.getSetting(\"PYTH_MAX_RETRIES\") || envConfig.PYTH_MAX_RETRIES.toString(),\r\n            PYTH_RETRY_DELAY: process.env.PYTH_RETRY_DELAY || runtime.getSetting(\"PYTH_RETRY_DELAY\") || envConfig.PYTH_RETRY_DELAY.toString(),\r\n            PYTH_GRANULAR_LOG: process.env.PYTH_GRANULAR_LOG === \"true\" || false,\r\n            PYTH_LOG_LEVEL: process.env.PYTH_LOG_LEVEL || runtime.getSetting(\"PYTH_LOG_LEVEL\") || envConfig.PYTH_LOG_LEVEL,\r\n            RUNTIME_CHECK_MODE: process.env.RUNTIME_CHECK_MODE === \"true\" || false,\r\n            PYTH_ENABLE_PRICE_STREAMING: process.env.PYTH_ENABLE_PRICE_STREAMING === \"true\" || true,\r\n            PYTH_MAX_PRICE_STREAMS: process.env.PYTH_MAX_PRICE_STREAMS || runtime.getSetting(\"PYTH_MAX_PRICE_STREAMS\") || envConfig.PYTH_MAX_PRICE_STREAMS.toString(),\r\n            PYTH_TEST_ID01: process.env.PYTH_TEST_ID01 || envConfig.PYTH_TEST_ID01,\r\n            PYTH_TEST_ID02: process.env.PYTH_TEST_ID02 || envConfig.PYTH_TEST_ID02,\r\n        };\r\n\r\n        return pythEnvSchema.parse(config);\r\n    } catch (error) {\r\n        const errorMessage = error instanceof Error ? error.message : String(error);\r\n        throw new Error(`Failed to validate Pyth configuration: ${errorMessage}`);\r\n    }\r\n}\r\n\r\n// Export network configurations\r\nexport const getNetworkConfig = (env: string = ENV) => PYTH_NETWORKS[env as keyof typeof PYTH_NETWORKS];\r\n","import { z } from 'zod';\r\nimport { DataError, ErrorSeverity, DataErrorCode } from '../error';\r\nimport { elizaLogger } from '@elizaos/core';\r\n\r\n// Schema for price feed attributes\r\nconst priceFeedAttributesSchema = z.object({\r\n    asset_type: z.string(),\r\n    base: z.string(),\r\n    description: z.string(),\r\n    display_symbol: z.string(),\r\n    quote_currency: z.string(),\r\n    schedule: z.string(),\r\n    symbol: z.string(),\r\n    generic_symbol: z.string().optional(),\r\n    cms_symbol: z.string().optional(),\r\n    country: z.string().optional(),\r\n    cqs_symbol: z.string().optional(),\r\n    nasdaq_symbol: z.string().optional(),\r\n    contract_id: z.string().optional()\r\n});\r\n\r\n// Schema for price feeds request\r\nexport const priceFeedsSchema = z.object({\r\n    text: z.string(),\r\n    query: z.string().optional(),\r\n    filter: z.string().optional(),\r\n    success: z.boolean().optional(),\r\n    data: z.object({\r\n        feeds: z.array(z.object({\r\n            id: z.string(),\r\n            attributes: priceFeedAttributesSchema\r\n        })),\r\n        count: z.number(),\r\n        responseType: z.string(),\r\n        isArray: z.boolean(),\r\n        error: z.string().optional()\r\n    }).optional()\r\n});\r\n\r\nexport async function validatePriceFeedsData(content: unknown): Promise<boolean> {\r\n    try {\r\n        const result = await priceFeedsSchema.parseAsync(content);\r\n        elizaLogger.debug('Price feeds validation passed', { result });\r\n        return true;\r\n    } catch (error) {\r\n        elizaLogger.error('Price feeds validation failed', { error });\r\n        throw new DataError(\r\n            DataErrorCode.VALIDATION_FAILED,\r\n            'Price feeds validation failed',\r\n            ErrorSeverity.HIGH,\r\n            { error }\r\n        );\r\n    }\r\n}","import { type Action, elizaLogger } from \"@elizaos/core\";\r\nimport type { IAgentRuntime, Memory, State, HandlerCallback, Content, ActionExample } from \"@elizaos/core\";\r\n// import { HermesClient } from \"../hermes/HermesClient\";\r\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\r\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\r\nimport { validatePythConfig, getNetworkConfig, getConfig } from \"../environment\";\r\nimport { validatePriceFeedsData } from \"../utils/priceFeedsValidation\";\r\n\r\n// Get configuration for granular logging\r\nconst config = getConfig();\r\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\r\n\r\n// Enhanced logging helper\r\nconst logGranular = (message: string, data?: unknown) => {\r\n    if (GRANULAR_LOG) {\r\n        elizaLogger.info(`[PriceFeeds] ${message}`, data);\r\n        console.log(`[PriceFeeds] ${message}`, data ? JSON.stringify(data, null, 2) : '');\r\n    }\r\n};\r\n\r\ninterface PriceFeedAttributes {\r\n    asset_type: string;\r\n    base: string;\r\n    description: string;\r\n    display_symbol: string;\r\n    quote_currency: string;\r\n    schedule: string;\r\n    symbol: string;\r\n    generic_symbol?: string;\r\n    cms_symbol?: string;\r\n    country?: string;\r\n    cqs_symbol?: string;\r\n    nasdaq_symbol?: string;\r\n    contract_id?: string;\r\n}\r\n\r\ninterface GetPriceFeedsContent extends Content {\r\n    text: string;\r\n    query?: string;\r\n    filter?: string;\r\n    success?: boolean;\r\n    data?: {\r\n        feeds: Array<{\r\n            id: string;\r\n            attributes: PriceFeedAttributes;\r\n        }>;\r\n        count: number;\r\n        responseType: string;\r\n        isArray: boolean;\r\n        error?: string;\r\n    };\r\n}\r\n\r\nexport const getPriceFeedsAction: Action = {\r\n    name: \"GET_PRICE_FEEDS\",\r\n    similes: [\"FETCH_PRICE_FEEDS\", \"LIST_PRICE_FEEDS\", \"QUERY_PRICE_FEEDS\"],\r\n    description: \"Retrieve price feeds from Pyth Network matching specific criteria\",\r\n    examples: [[\r\n        {\r\n            user: \"user\",\r\n            content: {\r\n                text: \"Get all available price feeds from Pyth Network\",\r\n                query: \"BTC\",\r\n                filter: \"USD\"\r\n            } as GetPriceFeedsContent\r\n        } as ActionExample,\r\n        {\r\n            user: \"assistant\",\r\n            content: {\r\n                text: \"Price feeds matching query BTC and filter USD\",\r\n                success: true,\r\n                query: \"BTC\",\r\n                filter: \"USD\",\r\n                data: {\r\n                    feeds: [{\r\n                        id: \"f9c0172ba10dfa4d19088d94f5bf61d3b54d5bd7483a322a982e1373ee8ea31b\",\r\n                        attributes: {\r\n                            asset_type: \"Crypto\",\r\n                            base: \"BTC\",\r\n                            description: \"BITCOIN / US DOLLAR\",\r\n                            display_symbol: \"BTC/USD\",\r\n                            generic_symbol: \"BTCUSD\",\r\n                            quote_currency: \"USD\",\r\n                            schedule: \"America/New_York;O,O,O,O,O,O,O;\",\r\n                            symbol: \"Crypto.BTC/USD\"\r\n                        }\r\n                    }]\r\n                }\r\n            } as GetPriceFeedsContent\r\n        } as ActionExample\r\n    ]],\r\n\r\n    async validate(runtime: IAgentRuntime, message: Memory): Promise<boolean> {\r\n        // Check if this message is intended for this action\r\n        if (message.content?.type !== \"GET_PRICE_FEEDS\") {\r\n            return true; // Skip validation for other actions\r\n        }\r\n\r\n        logGranular(\"Starting validation\", {\r\n            messageId: message.id,\r\n            content: message.content\r\n        });\r\n\r\n        try {\r\n            const content = message.content as GetPriceFeedsContent;\r\n            logGranular(\"Validating content structure\", { content });\r\n\r\n            // Validate against schema\r\n            try {\r\n                await validatePriceFeedsData(content);\r\n                logGranular(\"Schema validation passed\");\r\n            } catch (error) {\r\n                logGranular(\"Schema validation error\", { error });\r\n                if (error instanceof DataError) {\r\n                    elizaLogger.error(\"Schema validation failed\", {\r\n                        errors: error.details?.errors\r\n                    });\r\n                    throw error;\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Schema validation failed\",\r\n                    ErrorSeverity.HIGH,\r\n                    { error }\r\n                );\r\n            }\r\n\r\n            // Validate Pyth configuration\r\n            const config = await validatePythConfig(runtime);\r\n            logGranular(\"Pyth config validation\", { config });\r\n\r\n            if (!config) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Invalid Pyth configuration\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            // Content validation is optional for this action\r\n            if (content.query && typeof content.query !== 'string') {\r\n                logGranular(\"Invalid query type\", { query: content.query });\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Query must be a string\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            if (content.filter && typeof content.filter !== 'string') {\r\n                logGranular(\"Invalid filter type\", { filter: content.filter });\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Filter must be a string\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            logGranular(\"Validation successful\", {\r\n                query: content.query,\r\n                filter: content.filter\r\n            });\r\n\r\n            return true;\r\n        } catch (error) {\r\n            logGranular(\"Validation failed\", {\r\n                error: error instanceof Error ? {\r\n                    message: error.message,\r\n                    stack: error.stack,\r\n                    name: error.name\r\n                } : String(error)\r\n            });\r\n\r\n            if (error instanceof DataError) {\r\n                throw error;\r\n            }\r\n            throw new DataError(\r\n                DataErrorCode.VALIDATION_FAILED,\r\n                \"Invalid content format\",\r\n                ErrorSeverity.HIGH,\r\n                { content: message.content }\r\n            );\r\n        }\r\n    },\r\n\r\n    async handler(\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State | undefined,\r\n        _options: { [key: string]: unknown } = {},\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> {\r\n        logGranular(\"Starting handler execution\", {\r\n            messageId: message.id,\r\n            hasCallback: !!callback\r\n        });\r\n\r\n        try {\r\n            const messageContent = message.content as GetPriceFeedsContent;\r\n            const { query, filter } = messageContent;\r\n\r\n            logGranular(\"Processing request\", { query, filter });\r\n\r\n            // Get Pyth configuration\r\n            const config = await validatePythConfig(runtime);\r\n            logGranular(\"Got Pyth config\", { networkEnv: config.PYTH_NETWORK_ENV });\r\n\r\n            // Initialize HermesClient with configuration\r\n            const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\r\n            logGranular(\"Network config\", { networkConfig });\r\n\r\n            const client = new HermesClient(networkConfig.hermes);\r\n            logGranular(\"Initialized HermesClient\", {\r\n                endpoint: networkConfig.hermes\r\n            });\r\n\r\n            // Get price feeds with proper options\r\n            const options = {\r\n                query: query,\r\n                filter: filter\r\n            };\r\n\r\n            logGranular(\"Fetching price feeds with options\", {\r\n                options,\r\n                hermesEndpoint: networkConfig.hermes,\r\n                clientType: typeof client.getPriceFeeds\r\n            });\r\n\r\n            const priceFeeds = await client.getPriceFeeds(options);\r\n\r\n            logGranular(\"Retrieved price feeds\", {\r\n                responseType: typeof priceFeeds,\r\n                isArray: Array.isArray(priceFeeds),\r\n                count: priceFeeds?.length || 0,\r\n                sample: priceFeeds?.slice(0, 3) || [] // Log first 3 feeds for debugging\r\n            });\r\n\r\n            // Process and transform feeds\r\n            const transformedFeeds = priceFeeds.map((feed) => ({\r\n                id: feed.id,\r\n                attributes: {\r\n                    asset_type: feed.attributes?.asset_type || \"Unknown\",\r\n                    base: feed.attributes?.base || \"Unknown\",\r\n                    description: feed.attributes?.description || \"Unknown\",\r\n                    display_symbol: feed.attributes?.display_symbol || \"Unknown\",\r\n                    quote_currency: feed.attributes?.quote_currency || \"Unknown\",\r\n                    schedule: feed.attributes?.schedule || \"\",\r\n                    symbol: feed.attributes?.symbol || \"Unknown\",\r\n                    generic_symbol: feed.attributes?.generic_symbol,\r\n                    cms_symbol: feed.attributes?.cms_symbol,\r\n                    country: feed.attributes?.country,\r\n                    cqs_symbol: feed.attributes?.cqs_symbol,\r\n                    nasdaq_symbol: feed.attributes?.nasdaq_symbol,\r\n                    contract_id: feed.attributes?.contract_id\r\n                }\r\n            }));\r\n\r\n            // Prepare callback content\r\n            const callbackContent: GetPriceFeedsContent = {\r\n                text: `Retrieved ${priceFeeds.length} price feeds:\r\n${transformedFeeds.map(feed =>\r\n    `- ${feed.attributes.description} (${feed.attributes.display_symbol})\r\n  Type: ${feed.attributes.asset_type}\r\n  Base: ${feed.attributes.base}\r\n  Quote: ${feed.attributes.quote_currency}\r\n  Schedule: ${feed.attributes.schedule}\r\n  ID: ${feed.id}`\r\n).join('\\n')}\r\n${query ? `\\nMatching query: \"${query}\"` : ''}${filter ? `\\nWith filter: \"${filter}\"` : ''}`,\r\n                query,\r\n                filter,\r\n                success: true,\r\n                data: {\r\n                    feeds: transformedFeeds,\r\n                    count: priceFeeds.length,\r\n                    responseType: \"object\",\r\n                    isArray: true\r\n                }\r\n            };\r\n\r\n            logGranular(\"Prepared callback content\", {\r\n                feedCount: transformedFeeds.length,\r\n                firstFeed: transformedFeeds[0]\r\n            });\r\n\r\n            // Execute callback if provided\r\n            if (callback) {\r\n                logGranular(\"Executing callback\");\r\n                await callback(callbackContent);\r\n                logGranular(\"Callback completed\");\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\r\n            const errorStack = error instanceof Error ? error.stack : undefined;\r\n\r\n            logGranular(\"Error retrieving price feeds\", {\r\n                error: errorMessage,\r\n                stack: errorStack\r\n            });\r\n\r\n            // Prepare error callback content\r\n            const errorContent: GetPriceFeedsContent = {\r\n                text: `Failed to retrieve price feeds: ${errorMessage}\\nError details: ${errorStack || 'No stack trace available'}`,\r\n                success: false,\r\n                data: {\r\n                    feeds: [],\r\n                    error: errorMessage,\r\n                    count: 0,\r\n                    responseType: \"object\",\r\n                    isArray: true\r\n                }\r\n            };\r\n\r\n            // Execute callback if provided\r\n            if (callback) {\r\n                await callback(errorContent);\r\n            }\r\n\r\n            // Throw appropriate error\r\n            throw new DataError(\r\n                DataErrorCode.PRICE_FEEDS_FETCH_FAILED,\r\n                errorMessage,\r\n                ErrorSeverity.HIGH\r\n            );\r\n        }\r\n    }\r\n};\r\n\r\nexport default getPriceFeedsAction;\r\n","import { z } from 'zod';\r\nimport { DataError, ErrorSeverity, DataErrorCode } from '../error';\r\nimport { elizaLogger } from '@elizaos/core';\r\n\r\n// Schema for price update stream options\r\nconst streamOptionsSchema = z.object({\r\n    encoding: z.enum(['hex', 'base64']).optional(),\r\n    parsed: z.boolean().optional(),\r\n    allowUnordered: z.boolean().optional(),\r\n    benchmarksOnly: z.boolean().optional()\r\n});\r\n\r\n// Schema for price metadata\r\nconst priceMetadataSchema = z.object({\r\n    slot: z.number(),\r\n    proof_available_time: z.number(),\r\n    prev_publish_time: z.number()\r\n});\r\n\r\n// Schema for price data\r\nconst priceDataSchema = z.object({\r\n    price: z.string(),\r\n    conf: z.string(),\r\n    expo: z.number(),\r\n    publish_time: z.number()\r\n});\r\n\r\n// Schema for parsed price update\r\nconst parsedPriceUpdateSchema = z.object({\r\n    id: z.string(),\r\n    price: priceDataSchema,\r\n    ema_price: priceDataSchema,\r\n    metadata: priceMetadataSchema.optional()\r\n});\r\n\r\n// Schema for binary data\r\nconst binaryDataSchema = z.object({\r\n    encoding: z.string(),\r\n    data: z.array(z.string())\r\n});\r\n\r\n// Schema for price updates stream request\r\nexport const priceUpdateStreamSchema = z.object({\r\n    text: z.string(),\r\n    priceIds: z.array(z.string().regex(/^0x[0-9a-fA-F]{64}$/)),\r\n    options: streamOptionsSchema.optional(),\r\n    success: z.boolean().optional(),\r\n    data: z.object({\r\n        streamId: z.string(),\r\n        status: z.enum(['connected', 'disconnected', 'error']),\r\n        binary: binaryDataSchema.optional(),\r\n        parsed: z.array(parsedPriceUpdateSchema).optional(),\r\n        error: z.string().optional()\r\n    }).optional()\r\n});\r\n\r\nexport async function validatePriceUpdateStreamData(content: unknown): Promise<boolean> {\r\n    try {\r\n        const result = await priceUpdateStreamSchema.parseAsync(content);\r\n        elizaLogger.debug('Price update stream validation passed', { result });\r\n        return true;\r\n    } catch (error) {\r\n        elizaLogger.error('Price update stream validation failed', { error });\r\n        throw new DataError(\r\n            DataErrorCode.VALIDATION_FAILED,\r\n            'Price update stream validation failed',\r\n            ErrorSeverity.HIGH,\r\n            { error }\r\n        );\r\n    }\r\n}","import { type Action, elizaLogger } from \"@elizaos/core\";\r\nimport type { IAgentRuntime, Memory, State, HandlerCallback, Content, ActionExample } from \"@elizaos/core\";\r\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\r\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\r\nimport { validatePythConfig, getNetworkConfig, getConfig } from \"../environment\";\r\nimport { validatePriceUpdateStreamData } from \"../utils/priceUpdateStreamValidation\";\r\n\r\n// Get configuration for granular logging\r\nconst config = getConfig();\r\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\r\nconst PYTH_MAX_PRICE_STREAMS = Number(config.PYTH_MAX_PRICE_STREAMS);\r\n\r\n// Track active streams\r\nconst activeStreams = new Map<string, EventSource>();\r\n\r\n// Enhanced logging helper\r\nconst logGranular = (message: string, data?: unknown) => {\r\n    if (GRANULAR_LOG) {\r\n        elizaLogger.info(`[PriceUpdatesStream] ${message}`, data);\r\n        console.log(`[PriceUpdatesStream] ${message}`, data ? JSON.stringify(data, null, 2) : '');\r\n    }\r\n};\r\n\r\n// Add type for price update item\r\ninterface PriceUpdateItem {\r\n    id: string;\r\n    price: {\r\n        price: string;\r\n        conf: string;\r\n        expo: number;\r\n        publish_time: number;\r\n    };\r\n    ema_price: {\r\n        price: string;\r\n        conf: string;\r\n        expo: number;\r\n        publish_time: number;\r\n    };\r\n    metadata?: {\r\n        slot: number;\r\n        proof_available_time: number;\r\n        prev_publish_time: number;\r\n    };\r\n}\r\ninterface GetPriceUpdatesStreamContent extends Content {\r\n    text: string;\r\n    priceIds: string[];\r\n    options?: {\r\n        encoding?: \"hex\" | \"base64\";\r\n        parsed?: boolean;\r\n        allowUnordered?: boolean;\r\n        benchmarksOnly?: boolean;\r\n    };\r\n    success?: boolean;\r\n    data?: {\r\n        streamId: string;\r\n        status: 'connected' | 'disconnected' | 'error';\r\n        binary?: {\r\n            encoding: string;\r\n            data: string[];\r\n        };\r\n        parsed?: Array<{\r\n            id: string;\r\n            price: {\r\n                price: string;\r\n                conf: string;\r\n                expo: number;\r\n                publish_time: number;\r\n            };\r\n            ema_price: {\r\n                price: string;\r\n                conf: string;\r\n                expo: number;\r\n                publish_time: number;\r\n            };\r\n            metadata?: {\r\n                slot: number;\r\n                proof_available_time: number;\r\n                prev_publish_time: number;\r\n            };\r\n        }>;\r\n        error?: string;\r\n    };\r\n}\r\n\r\n// Helper function to extract price IDs from text\r\nfunction extractPriceIds(text: string): string[] {\r\n    let priceIds: string[] = [];\r\n\r\n    // Try to match common price symbols first\r\n    const symbolMatch = text.match(/(?:BTC|ETH|SOL)\\/USD/g);\r\n    if (symbolMatch) {\r\n        const symbolToId: { [key: string]: string } = {\r\n            'BTC/USD': '0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43',\r\n            'ETH/USD': '0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace',\r\n            'SOL/USD': '0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d'\r\n        };\r\n        priceIds = symbolMatch.map(symbol => symbolToId[symbol]).filter(id => id);\r\n    }\r\n\r\n    if (priceIds.length === 0) {\r\n        const hexMatchesWithPrefix = text.match(/0x[0-9a-fA-F]{64}/g);\r\n        if (hexMatchesWithPrefix) {\r\n            priceIds = hexMatchesWithPrefix;\r\n        } else {\r\n            const hexMatches = text.match(/[0-9a-fA-F]{64}/g);\r\n            if (hexMatches) {\r\n                priceIds = hexMatches.map(id => `0x${id}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    return priceIds;\r\n}\r\n\r\n// Define proper types for the processed data\r\ninterface ProcessedPriceData {\r\n    binary?: {\r\n        encoding: string;\r\n        data: string[];\r\n    };\r\n    parsed?: Array<{\r\n        id: string;\r\n        price: {\r\n            price: string;\r\n            conf: string;\r\n            expo: number;\r\n            publish_time: number;\r\n        };\r\n        ema_price: {\r\n            price: string;\r\n            conf: string;\r\n            expo: number;\r\n            publish_time: number;\r\n        };\r\n        metadata?: {\r\n            slot: number;\r\n            proof_available_time: number;\r\n            prev_publish_time: number;\r\n        };\r\n    }>;\r\n}\r\n\r\ninterface RawPriceData {\r\n    binary: {\r\n        encoding: string;\r\n        data: string[];\r\n    };\r\n    parsed: Array<PriceUpdateItem>;\r\n}\r\n\r\n// Helper function to process price update data\r\nfunction processPriceUpdateData(data: RawPriceData): ProcessedPriceData {\r\n    return {\r\n        binary: data.binary,\r\n        parsed: data.parsed.map((item: PriceUpdateItem) => ({\r\n            id: item.id,\r\n            price: {\r\n                price: item.price.price,\r\n                conf: item.price.conf,\r\n                expo: item.price.expo,\r\n                publish_time: item.price.publish_time\r\n            },\r\n            ema_price: {\r\n                price: item.ema_price.price,\r\n                conf: item.ema_price.conf,\r\n                expo: item.ema_price.expo,\r\n                publish_time: item.ema_price.publish_time\r\n            },\r\n            metadata: item.metadata ? {\r\n                slot: item.metadata.slot,\r\n                proof_available_time: item.metadata.proof_available_time,\r\n                prev_publish_time: item.metadata.prev_publish_time\r\n            } : undefined\r\n        }))\r\n    };\r\n}\r\n\r\n// Helper function to format price update text\r\nfunction formatPriceUpdateText(streamId: string, messageCount: number, data: RawPriceData): string {\r\n    return `Price Update Stream (ID: stream_${streamId}, Update ${messageCount}/${PYTH_MAX_PRICE_STREAMS}):\r\n${data.parsed.map((item: PriceUpdateItem) =>\r\n    `Price Feed: ${item.id}\r\nCurrent Price: ${(Number(item.price.price) * Math.pow(10, item.price.expo)).toFixed(2)} USD\r\nConfidence: ${(Number(item.price.conf) * Math.pow(10, item.price.expo)).toFixed(2)} USD\r\nEMA Price: ${(Number(item.ema_price.price) * Math.pow(10, item.ema_price.expo)).toFixed(2)} USD\r\nEMA Confidence: ${(Number(item.ema_price.conf) * Math.pow(10, item.ema_price.expo)).toFixed(2)} USD\r\nLast Update: ${new Date(item.price.publish_time * 1000).toLocaleString()}${item.metadata ? `\r\nSlot: ${item.metadata.slot}\r\nProof Available: ${new Date(item.metadata.proof_available_time * 1000).toLocaleString()}` : ''}`\r\n).join('\\n\\n')}`;\r\n}\r\n\r\n// Function to collect stream data\r\nasync function collectStreamData(eventSource: EventSource, streamId: string): Promise<RawPriceData> {\r\n    return new Promise((resolve, reject) => {\r\n        let messageCount = 0;\r\n        const collectedData: RawPriceData = {\r\n            binary: { encoding: 'hex', data: [] },\r\n            parsed: []\r\n        };\r\n\r\n        eventSource.onmessage = (event) => {\r\n            messageCount++;\r\n            logGranular(\"Received price update\", { streamId, messageCount, data: event.data });\r\n\r\n            try {\r\n                const rawData = JSON.parse(event.data) as RawPriceData;\r\n                collectedData.binary.data.push(...rawData.binary.data);\r\n                collectedData.parsed.push(...rawData.parsed);\r\n\r\n                if (messageCount >= PYTH_MAX_PRICE_STREAMS) {\r\n                    eventSource.close();\r\n                    resolve(collectedData);\r\n                }\r\n            } catch (error) {\r\n                eventSource.close();\r\n                reject(error);\r\n            }\r\n        };\r\n\r\n        eventSource.onerror = (error) => {\r\n            eventSource.close();\r\n            reject(error);\r\n        };\r\n    });\r\n}\r\n\r\n// Helper function to create and manage price stream\r\nasync function createPriceStream(\r\n    runtime: IAgentRuntime,\r\n    priceIds: string[],\r\n    callback?: HandlerCallback\r\n): Promise<void> {\r\n    const config = await validatePythConfig(runtime);\r\n    if (!config) {\r\n        throw new DataError(\r\n            DataErrorCode.VALIDATION_FAILED,\r\n            \"Invalid Pyth configuration\",\r\n            ErrorSeverity.HIGH\r\n        );\r\n    }\r\n\r\n    const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\r\n    const client = new HermesClient(networkConfig.hermes);\r\n    const streamId = `stream_${Date.now()}`;\r\n\r\n    logGranular(\"Creating price stream for IDs:\", { streamId, priceIds });\r\n\r\n    try {\r\n        const eventSource = (await client.getPriceUpdatesStream(priceIds, {\r\n            parsed: true,\r\n            encoding: 'hex'\r\n        })) as unknown as EventSource;\r\n\r\n        // Store the stream\r\n        activeStreams.set(streamId, eventSource as any);\r\n\r\n        try {\r\n            // Collect all stream data\r\n            const collectedData = await collectStreamData(eventSource as any, streamId);\r\n\r\n            // Process collected data\r\n            const processedData = processPriceUpdateData(collectedData);\r\n            const updateText = formatPriceUpdateText(streamId, PYTH_MAX_PRICE_STREAMS, collectedData);\r\n\r\n            // Send single callback with all data\r\n            if (callback) {\r\n                callback({\r\n                    text: updateText,\r\n                    success: true,\r\n                    priceIds,\r\n                    data: {\r\n                        streamId,\r\n                        status: 'connected',\r\n                        ...processedData\r\n                    }\r\n                } as GetPriceUpdatesStreamContent);\r\n            }\r\n\r\n            activeStreams.delete(streamId);\r\n            logGranular(\"Stream completed successfully\", { streamId });\r\n\r\n        } catch (error) {\r\n            logGranular(\"Error collecting stream data\", { streamId, error });\r\n            if (callback) {\r\n                callback({\r\n                    text: `Error processing price updates: ${error instanceof Error ? error.message : String(error)}`,\r\n                    success: false,\r\n                    priceIds,\r\n                    data: {\r\n                        streamId,\r\n                        status: 'error',\r\n                        error: error instanceof Error ? error.message : String(error)\r\n                    }\r\n                } as GetPriceUpdatesStreamContent);\r\n            }\r\n            activeStreams.delete(streamId);\r\n            throw error;\r\n        }\r\n    } catch (error) {\r\n        logGranular(\"Error creating price stream\", { streamId, error });\r\n        throw new DataError(\r\n            DataErrorCode.TRANSFORM_ERROR,\r\n            error instanceof Error ? error.message : String(error),\r\n            ErrorSeverity.HIGH\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const getPriceUpdatesStreamAction: Action = {\r\n    name: \"GET_PRICE_UPDATES_STREAM\",\r\n    similes: [\"STREAM_PRICE_UPDATES\", \"SUBSCRIBE_TO_PRICES\", \"WATCH_PRICE_FEED\"],\r\n    description: \"Create a streaming connection for real-time price updates from Pyth Network\",\r\n    examples: [[\r\n        {\r\n            user: \"user\",\r\n            content: {\r\n                text: \"Stream BTC/USD price updates\",\r\n                priceIds: [\"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"],\r\n                options: {\r\n                    encoding: \"hex\",\r\n                    parsed: true,\r\n                    benchmarksOnly: true\r\n                }\r\n            } as GetPriceUpdatesStreamContent\r\n        } as ActionExample,\r\n        {\r\n            user: \"assistant\",\r\n            content: {\r\n                text: \"Starting BTC/USD price stream...\",\r\n                success: true,\r\n                priceIds: [\"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"],\r\n                data: {\r\n                    streamId: \"stream_1\",\r\n                    status: \"connected\",\r\n                    updates: [{\r\n                        id: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                        price: 42000,\r\n                        confidence: 100,\r\n                        timestamp: 1641034800,\r\n                        emaPrice: 41950\r\n                    }]\r\n                }\r\n            } as GetPriceUpdatesStreamContent\r\n        } as ActionExample\r\n    ], [\r\n        {\r\n            user: \"user\",\r\n            content: {\r\n                text: \"Stream ETH and BTC prices with benchmarks only\",\r\n                priceIds: [\r\n                    \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                    \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\"\r\n                ],\r\n                options: {\r\n                    benchmarksOnly: true,\r\n                    parsed: true\r\n                }\r\n            } as GetPriceUpdatesStreamContent\r\n        } as ActionExample,\r\n        {\r\n            user: \"assistant\",\r\n            content: {\r\n                text: \"Starting price stream for BTC and ETH...\",\r\n                success: true,\r\n                priceIds: [\r\n                    \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                    \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\"\r\n                ],\r\n                data: {\r\n                    streamId: \"stream_2\",\r\n                    status: \"connected\",\r\n                    updates: [\r\n                        {\r\n                            id: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                            price: 42000,\r\n                            confidence: 100,\r\n                            timestamp: 1641034800,\r\n                            emaPrice: 41950\r\n                        },\r\n                        {\r\n                            id: \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\r\n                            price: 2500,\r\n                            confidence: 50,\r\n                            timestamp: 1641034800,\r\n                            emaPrice: 2495\r\n                        }\r\n                    ]\r\n                }\r\n            } as GetPriceUpdatesStreamContent\r\n        } as ActionExample\r\n    ]],\r\n\r\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\r\n        // Check if this message is intended for this action\r\n        if (message.content?.type !== \"GET_PRICE_UPDATES_STREAM\") {\r\n            return true; // Skip validation for other actions\r\n        }\r\n\r\n        logGranular(\"Starting validation\", {\r\n            content: message.content\r\n        });\r\n\r\n        try {\r\n            let content = message.content as GetPriceUpdatesStreamContent;\r\n\r\n            // Handle text-only input by extracting priceIds\r\n            if (!content.priceIds) {\r\n                const priceIds = extractPriceIds(content.text);\r\n                if (priceIds.length > 0) {\r\n                    content = {\r\n                        ...content,\r\n                        priceIds,\r\n                        options: {\r\n                            parsed: true,\r\n                            encoding: \"hex\"\r\n                        }\r\n                    };\r\n                    message.content = content;\r\n                }\r\n            }\r\n\r\n            // Validate against schema\r\n            try {\r\n                await validatePriceUpdateStreamData(content);\r\n                logGranular(\"Schema validation passed\");\r\n            } catch (error) {\r\n                logGranular(\"Schema validation failed\", { error });\r\n                if (error instanceof DataError) {\r\n                    elizaLogger.error(\"Schema validation failed\", {\r\n                        errors: error.details?.errors\r\n                    });\r\n                    throw error;\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Schema validation failed\",\r\n                    ErrorSeverity.HIGH,\r\n                    { error }\r\n                );\r\n            }\r\n\r\n            // Validate Pyth configuration\r\n            const config = await validatePythConfig(_runtime);\r\n            if (!config) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Invalid Pyth configuration\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            if (!content.priceIds || !Array.isArray(content.priceIds)) {\r\n                throw DataError.validationFailed(content, [\"priceIds must be an array of strings\"]);\r\n            }\r\n\r\n            if (content.priceIds.length === 0) {\r\n                throw DataError.validationFailed(content, [\"priceIds array cannot be empty\"]);\r\n            }\r\n\r\n            // Validate each price ID is a valid hex string\r\n            content.priceIds.forEach((id, index) => {\r\n                if (!/^0x[0-9a-fA-F]{64}$/.test(id)) {\r\n                    throw DataError.validationFailed(content, [`Invalid price ID at index ${index}: ${id}`]);\r\n                }\r\n            });\r\n\r\n            // Validate options if provided\r\n            if (content.options) {\r\n                const { encoding, parsed, allowUnordered, benchmarksOnly } = content.options;\r\n\r\n                if (encoding && ![\"hex\", \"base64\"].includes(encoding)) {\r\n                    throw DataError.validationFailed(content, [\"encoding must be either 'hex' or 'base64'\"]);\r\n                }\r\n\r\n                if (parsed !== undefined && typeof parsed !== \"boolean\") {\r\n                    throw DataError.validationFailed(content, [\"parsed must be a boolean\"]);\r\n                }\r\n\r\n                if (allowUnordered !== undefined && typeof allowUnordered !== \"boolean\") {\r\n                    throw DataError.validationFailed(content, [\"allowUnordered must be a boolean\"]);\r\n                }\r\n\r\n                if (benchmarksOnly !== undefined && typeof benchmarksOnly !== \"boolean\") {\r\n                    throw DataError.validationFailed(content, [\"benchmarksOnly must be a boolean\"]);\r\n                }\r\n            }\r\n\r\n            logGranular(\"GET_PRICE_UPDATES_STREAM validation successful\", {\r\n                priceIds: content.priceIds,\r\n                options: content.options\r\n            });\r\n\r\n            return true;\r\n        } catch (error) {\r\n            logGranular(\"Validation failed\", { error });\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    async handler(\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State | undefined,\r\n        _options: { [key: string]: unknown } = {},\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> {\r\n        logGranular(\"Starting handler execution\", {\r\n            messageId: message.id,\r\n            messageContent: message.content\r\n        });\r\n\r\n        try {\r\n            const messageContent = message.content as GetPriceUpdatesStreamContent;\r\n            let priceIds = messageContent.priceIds;\r\n\r\n            // If no priceIds in content, try to extract them\r\n            if (!priceIds) {\r\n                priceIds = extractPriceIds(messageContent.text);\r\n                if (priceIds.length === 0) {\r\n                    throw new DataError(\r\n                        DataErrorCode.VALIDATION_FAILED,\r\n                        \"Could not extract any valid price IDs from message\",\r\n                        ErrorSeverity.HIGH\r\n                    );\r\n                }\r\n            }\r\n\r\n            await createPriceStream(runtime, priceIds, callback);\r\n            return true;\r\n\r\n        } catch (error) {\r\n            logGranular(\"Error in price updates stream handler\", error);\r\n            throw new DataError(\r\n                DataErrorCode.TRANSFORM_ERROR,\r\n                error instanceof Error ? error.message : String(error),\r\n                ErrorSeverity.HIGH\r\n            );\r\n        }\r\n    }\r\n};\r\n\r\nexport default getPriceUpdatesStreamAction;\r\n\r\n","import { type Action, elizaLogger } from \"@elizaos/core\";\r\nimport type { IAgentRuntime, Memory, State, HandlerCallback, Content, ActionExample } from \"@elizaos/core\";\r\n// import { HermesClient } from \"../hermes/HermesClient\";\r\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\r\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\r\nimport { validatePythConfig, getNetworkConfig, getConfig } from \"../environment\";\r\nimport { validatePriceUpdatesData } from \"../utils/priceUpdatesValidation\";\r\n\r\n// Get configuration for granular logging\r\nconst config = getConfig();\r\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\r\n\r\n// Enhanced logging helper\r\nconst logGranular = (message: string, data?: unknown) => {\r\n    if (GRANULAR_LOG) {\r\n        elizaLogger.info(`[PriceUpdates] ${message}`, data);\r\n        console.log(`[PriceUpdates] ${message}`, data ? JSON.stringify(data, null, 2) : '');\r\n    }\r\n};\r\n\r\n// Helper function to normalize price feed IDs\r\nconst normalizePriceFeedId = (id: string): string => {\r\n    // Ensure 0x prefix and lowercase\r\n    return id.toLowerCase().startsWith('0x') ? id.toLowerCase() : `0x${id.toLowerCase()}`;\r\n};\r\n\r\n// Helper function to format price feed ID for display\r\nconst formatPriceFeedId = (id: string): string => {\r\n    // Add '0x' prefix if not present\r\n    return id.toLowerCase().startsWith('0x') ? id.toLowerCase() : `0x${id.toLowerCase()}`;\r\n};\r\n\r\ninterface GetLatestPriceUpdatesContent extends Content {\r\n    text: string;\r\n    priceIds: string[];\r\n    options?: {\r\n        encoding?: \"hex\" | \"base64\";\r\n        parsed?: boolean;\r\n    };\r\n    success?: boolean;\r\n    data?: {\r\n        updates?: Array<{\r\n            price_feed_id: string;\r\n            price: number;\r\n            conf: number;\r\n            expo: number;\r\n            publish_time: number;\r\n            ema_price?: {\r\n                price: number;\r\n                conf: number;\r\n                expo: number;\r\n            };\r\n        }>;\r\n        error?: string;\r\n    };\r\n}\r\n\r\nexport const getLatestPriceUpdatesAction: Action = {\r\n    name: \"GET_LATEST_PRICE_UPDATES\",\r\n    similes: [\"FETCH_LATEST_PRICES\", \"GET_CURRENT_PRICES\", \"CHECK_PRICE_FEED\"],\r\n    description: \"Retrieve latest price updates from Pyth Network\",\r\n    examples: [[\r\n        {\r\n            user: \"user\",\r\n            content: {\r\n                text: \"Get latest price updates for 0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                priceIds: [\"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"],\r\n                options: {\r\n                    encoding: \"base64\",\r\n                    parsed: true\r\n                }\r\n            } as GetLatestPriceUpdatesContent\r\n        } as ActionExample,\r\n        {\r\n            user: \"assistant\",\r\n            content: {\r\n                text: \"Here is the latest BTC/USD price\",\r\n                success: true,\r\n                priceIds: [\"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"],\r\n                data: {\r\n                    updates: [{\r\n                        price_feed_id: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\r\n                        price: 42000000000,\r\n                        conf: 100000000,\r\n                        expo: -8,\r\n                        publish_time: 1641034800,\r\n                        ema_price: {\r\n                            price: 41950000000,\r\n                            conf: 95000000,\r\n                            expo: -8\r\n                        }\r\n                    }]\r\n                }\r\n            } as GetLatestPriceUpdatesContent\r\n        } as ActionExample\r\n    ]],\r\n\r\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\r\n        // Check if this message is intended for this action\r\n        if (message.content?.type !== \"GET_LATEST_PRICE_UPDATES\") {\r\n            return true; // Skip validation for other actions\r\n        }\r\n\r\n        logGranular(\"Validating GET_LATEST_PRICE_UPDATES action\", {\r\n            content: message.content\r\n        });\r\n\r\n        try {\r\n            const content = message.content as GetLatestPriceUpdatesContent;\r\n\r\n            // Extract priceIds from text if not provided directly\r\n            if (!content.priceIds && content.text) {\r\n                const match = content.text.match(/([a-fA-F0-9]{64})/);\r\n                if (match) {\r\n                    content.priceIds = [formatPriceFeedId(match[1])];\r\n                }\r\n            }\r\n\r\n            // Normalize all price feed IDs\r\n            if (content.priceIds) {\r\n                content.priceIds = content.priceIds.map(normalizePriceFeedId);\r\n            }\r\n\r\n            // Use the new validation function\r\n            try {\r\n                await validatePriceUpdatesData(content);\r\n                logGranular(\"Schema validation passed\");\r\n            } catch (error) {\r\n                logGranular(\"Schema validation failed\", { error });\r\n                if (error instanceof DataError) {\r\n                    elizaLogger.error(\"Schema validation failed\", {\r\n                        errors: error.details?.errors\r\n                    });\r\n                    throw error;\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Schema validation failed\",\r\n                    ErrorSeverity.HIGH,\r\n                    { error }\r\n                );\r\n            }\r\n\r\n            // Keep existing validation as additional checks\r\n            if (!content.priceIds || !Array.isArray(content.priceIds)) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"priceIds must be an array of strings\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            if (content.priceIds.length === 0) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"priceIds array cannot be empty\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            // Validate each price ID is a valid hex string\r\n            content.priceIds.forEach((id, index) => {\r\n                const cleanId = id.startsWith('0x') ? id.slice(2) : id;\r\n                if (!/^[0-9a-fA-F]{64}$/.test(cleanId)) {\r\n                    throw new DataError(\r\n                        DataErrorCode.VALIDATION_FAILED,\r\n                        `Invalid price ID at index ${index}: ${id}. Must be a 64-character hex string`,\r\n                        ErrorSeverity.HIGH\r\n                    );\r\n                }\r\n            });\r\n\r\n            // Validate options if provided\r\n            if (content.options) {\r\n                if (content.options.encoding && ![\"hex\", \"base64\"].includes(content.options.encoding)) {\r\n                    throw new DataError(\r\n                        DataErrorCode.VALIDATION_FAILED,\r\n                        \"Invalid encoding option. Must be 'hex' or 'base64'\",\r\n                        ErrorSeverity.HIGH\r\n                    );\r\n                }\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            logGranular(\"Validation failed\", { error });\r\n            elizaLogger.error(\"Validation failed for GET_LATEST_PRICE_UPDATES\", {\r\n                error: error instanceof Error ? error.message : String(error)\r\n            });\r\n            return false;\r\n        }\r\n    },\r\n\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        _state?: State,\r\n        _options: { [key: string]: unknown } = {},\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        logGranular(\"Executing GET_LATEST_PRICE_UPDATES action\");\r\n\r\n        try {\r\n            const messageContent = message.content as GetLatestPriceUpdatesContent;\r\n\r\n            // Log the full message content\r\n            logGranular(\"Message content received\", messageContent);\r\n\r\n            // Extract priceIds from text if not provided directly\r\n            if (!messageContent.priceIds && messageContent.text) {\r\n                const match = messageContent.text.match(/([a-fA-F0-9]{64})/);\r\n                if (match) {\r\n                    messageContent.priceIds = [formatPriceFeedId(match[1])];\r\n                }\r\n            }\r\n\r\n            // Normalize all price feed IDs\r\n            if (messageContent.priceIds) {\r\n                messageContent.priceIds = messageContent.priceIds.map(normalizePriceFeedId);\r\n            }\r\n\r\n            const { priceIds, options = {} } = messageContent;\r\n\r\n            // Log extracted values\r\n            logGranular(\"Extracted values\", {\r\n                priceIds,\r\n                options\r\n            });\r\n\r\n            // Get Pyth configuration\r\n            const config = await validatePythConfig(runtime);\r\n            if (!config) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Invalid Pyth configuration\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            // Get network configuration\r\n            const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\r\n            const hermesClient = new HermesClient(networkConfig.hermes);\r\n\r\n            logGranular(\"Initialized HermesClient\", {\r\n                endpoint: networkConfig.hermes\r\n            });\r\n\r\n            try {\r\n                // Log the request details\r\n                logGranular(\"Requesting price updates with params\", {\r\n                    priceIds,\r\n                    options\r\n                });\r\n\r\n                // Get latest price updates\r\n                const updates = await hermesClient.getLatestPriceUpdates(priceIds, {\r\n                    parsed: true,\r\n                    encoding: options?.encoding as \"hex\" | \"base64\" | undefined\r\n                });\r\n\r\n                // Log the raw response\r\n                logGranular(\"Raw response from Hermes\", {\r\n                    updates\r\n                });\r\n\r\n                if (!updates || !updates.parsed) {\r\n                    throw new Error(\"No updates received from Hermes\");\r\n                }\r\n\r\n                logGranular(\"Successfully retrieved price updates\", {\r\n                    updates,\r\n                    parsedCount: updates.parsed?.length\r\n                });\r\n\r\n                if (callback) {\r\n                    const formattedText = updates.parsed?.map(update => {\r\n                        const metadata = update.metadata;\r\n                        const proofTime = metadata?.proof_available_time;\r\n                        return `Price Feed: ${normalizePriceFeedId(update.id)}\r\nCurrent Price: ${(Number(update.price.price) * Math.pow(10, update.price.expo)).toFixed(2)} USD\r\nConfidence: ${(Number(update.price.conf) * Math.pow(10, update.price.expo)).toFixed(2)} USD\r\nEMA Price: ${(Number(update.ema_price.price) * Math.pow(10, update.ema_price.expo)).toFixed(2)} USD\r\nEMA Confidence: ${(Number(update.ema_price.conf) * Math.pow(10, update.ema_price.expo)).toFixed(2)} USD\r\nLast Update: ${new Date(update.price.publish_time * 1000).toLocaleString()}${metadata ? `\r\nSlot: ${metadata.slot}\r\nProof Available: ${proofTime ? new Date(proofTime * 1000).toLocaleString() : 'Not available'}` : ''}`;\r\n                    }).join('\\n\\n');\r\n\r\n                    callback({\r\n                        text: formattedText,\r\n                        success: true,\r\n                        priceIds,\r\n                        data: {\r\n                            updates: updates.parsed?.map(update => ({\r\n                                price_feed_id: normalizePriceFeedId(update.id),\r\n                                price: Number(update.price.price),\r\n                                conf: Number(update.price.conf),\r\n                                expo: update.price.expo,\r\n                                publish_time: update.price.publish_time,\r\n                                ema_price: update.ema_price ? {\r\n                                    price: Number(update.ema_price.price),\r\n                                    conf: Number(update.ema_price.conf),\r\n                                    expo: update.ema_price.expo\r\n                                } : undefined,\r\n                                metadata: update.metadata\r\n                            }))\r\n                        }\r\n                    } as GetLatestPriceUpdatesContent);\r\n                }\r\n\r\n                return true;\r\n            } catch (error) {\r\n                logGranular(\"Failed to process price updates request\", { error });\r\n                if (callback) {\r\n                    callback({\r\n                        text: `Error retrieving price updates: ${error instanceof Error ? error.message : String(error)}`,\r\n                        success: false,\r\n                        priceIds,\r\n                        data: {\r\n                            error: error instanceof Error ? error.message : String(error)\r\n                        }\r\n                    } as GetLatestPriceUpdatesContent);\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Failed to process price updates request\",\r\n                    ErrorSeverity.HIGH,\r\n                    { originalError: error }\r\n                );\r\n            }\r\n        } catch (error) {\r\n            logGranular(\"Failed to get latest price updates\", { error });\r\n            throw new DataError(\r\n                DataErrorCode.NETWORK_ERROR,\r\n                \"Failed to get latest price updates\",\r\n                ErrorSeverity.HIGH,\r\n                { originalError: error }\r\n            );\r\n        }\r\n    }\r\n};\r\n\r\nexport default getLatestPriceUpdatesAction;\r\n","import { elizaLogger } from \"@elizaos/core\";\r\nimport { DataError, PythErrorCode, ErrorSeverity } from \"../error\";\r\nimport Ajv, { type ErrorObject } from \"ajv\";\r\n\r\nconst ajv = new Ajv({\r\n    allErrors: true,\r\n    verbose: true,\r\n    coerceTypes: true,\r\n    useDefaults: true\r\n});\r\n\r\n// Price updates schema\r\nexport const priceUpdatesSchema = {\r\n    type: 'object',\r\n    required: ['priceIds'],\r\n    properties: {\r\n        text: { type: 'string' },\r\n        priceIds: {\r\n            type: 'array',\r\n            items: {\r\n                type: 'string',\r\n                pattern: '^(0x)?[0-9a-fA-F]+$'\r\n            },\r\n            minItems: 1,\r\n            description: 'Array of price feed IDs to fetch updates for'\r\n        },\r\n        options: {\r\n            type: 'object',\r\n            properties: {\r\n                encoding: {\r\n                    type: 'string',\r\n                    enum: ['hex', 'base64'],\r\n                    description: 'Encoding format for the price updates'\r\n                },\r\n                parsed: {\r\n                    type: 'boolean',\r\n                    description: 'Whether to return parsed price updates'\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Validates price updates data against the schema\r\n * @param data Data to validate\r\n * @returns Promise<boolean> True if validation succeeds\r\n * @throws DataError if validation fails\r\n */\r\nexport async function validatePriceUpdatesData(data: unknown): Promise<boolean> {\r\n    try {\r\n        const validate = ajv.compile(priceUpdatesSchema);\r\n        const valid = validate(data);\r\n\r\n        if (!valid) {\r\n            const errors = validate.errors || [];\r\n            elizaLogger.error(\"Price updates validation failed\", {\r\n                errors,\r\n                data\r\n            });\r\n\r\n            throw new DataError(\r\n                PythErrorCode.DATA_VALIDATION_FAILED,\r\n                \"Price updates validation failed\",\r\n                ErrorSeverity.HIGH,\r\n                {\r\n                    errors: errors.map((err: ErrorObject) => ({\r\n                        path: err.schemaPath,\r\n                        message: err.message,\r\n                        params: err.params\r\n                    })),\r\n                    data\r\n                }\r\n            );\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        if (error instanceof DataError) {\r\n            throw error;\r\n        }\r\n\r\n        elizaLogger.error(\"Price updates validation error\", {\r\n            error: error instanceof Error ? error.message : String(error),\r\n            data\r\n        });\r\n\r\n        throw new DataError(\r\n            PythErrorCode.DATA_SCHEMA_ERROR,\r\n            \"Price updates validation error\",\r\n            ErrorSeverity.HIGH,\r\n            {\r\n                error: error instanceof Error ? error.message : String(error),\r\n                data\r\n            }\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * Validates a price ID format\r\n * @param priceId Price ID to validate\r\n * @returns boolean True if price ID is valid\r\n */\r\nexport function validatePriceId(priceId: string): boolean {\r\n    return /^(0x)?[0-9a-fA-F]+$/.test(priceId);\r\n}","import { elizaLogger } from \"@elizaos/core\";\r\nimport { DataError, PythErrorCode, ErrorSeverity } from \"../error\";\r\nimport Ajv, { type ErrorObject } from \"ajv\";\r\n\r\nconst ajv = new Ajv({\r\n    allErrors: true,\r\n    verbose: true,\r\n    coerceTypes: true,\r\n    useDefaults: true\r\n});\r\n\r\n// Publisher caps schema\r\nexport const publisherCapsSchema = {\r\n    type: 'object',\r\n    properties: {\r\n        text: { type: 'string' },\r\n        success: { type: 'boolean' },\r\n        data: {\r\n            type: 'object',\r\n            properties: {\r\n                caps: {\r\n                    type: 'array',\r\n                    items: {\r\n                        type: 'object',\r\n                        required: ['publisher', 'cap', 'timestamp'],\r\n                        properties: {\r\n                            publisher: {\r\n                                type: 'string',\r\n                                pattern: '^0x[a-fA-F0-9]{40}$'  // Ethereum address format\r\n                            },\r\n                            cap: {\r\n                                type: 'number',\r\n                                minimum: 0\r\n                            },\r\n                            timestamp: {\r\n                                type: 'number',\r\n                                minimum: 0\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                error: { type: 'string' }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Validates publisher caps data against the schema\r\n * @param data Data to validate\r\n * @returns Promise<boolean> True if validation succeeds\r\n * @throws DataError if validation fails\r\n */\r\nexport async function validatePublisherCapsData(data: unknown): Promise<boolean> {\r\n    try {\r\n        const validate = ajv.compile(publisherCapsSchema);\r\n        const valid = validate(data);\r\n\r\n        if (!valid) {\r\n            const errors = validate.errors || [];\r\n            elizaLogger.error(\"Publisher caps validation failed\", {\r\n                errors,\r\n                data\r\n            });\r\n\r\n            throw new DataError(\r\n                PythErrorCode.DATA_VALIDATION_FAILED,\r\n                \"Publisher caps validation failed\",\r\n                ErrorSeverity.HIGH,\r\n                {\r\n                    errors: errors.map((err: ErrorObject) => ({\r\n                        path: err.schemaPath,\r\n                        message: err.message,\r\n                        params: err.params\r\n                    })),\r\n                    data\r\n                }\r\n            );\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        if (error instanceof DataError) {\r\n            throw error;\r\n        }\r\n\r\n        elizaLogger.error(\"Publisher caps validation error\", {\r\n            error: error instanceof Error ? error.message : String(error),\r\n            data\r\n        });\r\n\r\n        throw new DataError(\r\n            PythErrorCode.DATA_SCHEMA_ERROR,\r\n            \"Publisher caps validation error\",\r\n            ErrorSeverity.HIGH,\r\n            {\r\n                error: error instanceof Error ? error.message : String(error),\r\n                data\r\n            }\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * Validates a publisher address format\r\n * @param publisher Publisher address to validate\r\n * @returns boolean True if address is valid\r\n */\r\nexport function validatePublisherAddress(publisher: string): boolean {\r\n    return /^0x[a-fA-F0-9]{40}$/.test(publisher);\r\n}\r\n\r\n/**\r\n * Validates a cap value\r\n * @param cap Cap value to validate\r\n * @returns boolean True if cap is valid\r\n */\r\nexport function validateCap(cap: number): boolean {\r\n    return !isNaN(cap) && cap >= 0;\r\n}","import { type Action, elizaLogger } from \"@elizaos/core\";\r\nimport type { IAgentRuntime, Memory, State, HandlerCallback, Content, ActionExample } from \"@elizaos/core\";\r\n// import { HermesClient } from \"../hermes/HermesClient\";\r\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\r\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\r\nimport { validatePythConfig, getNetworkConfig, getConfig } from \"../environment\";\r\nimport { validatePublisherCapsData } from \"../utils/publisherCapsValidation\";\r\n\r\n// Get configuration for granular logging\r\nconst config = getConfig();\r\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\r\n\r\n// Enhanced logging helper\r\nconst logGranular = (message: string, data?: unknown) => {\r\n    if (GRANULAR_LOG) {\r\n        elizaLogger.info(`[PublisherCaps] ${message}`, data);\r\n        console.log(`[PublisherCaps] ${message}`, data ? JSON.stringify(data, null, 2) : '');\r\n    }\r\n};\r\n\r\ninterface GetLatestPublisherCapsContent extends Content {\r\n    text: string;\r\n    success?: boolean;\r\n    data?: {\r\n        caps?: Array<{\r\n            publisher: string;\r\n            cap: number;\r\n            timestamp: number;\r\n        }>;\r\n        error?: string;\r\n    };\r\n}\r\n\r\nexport const getLatestPublisherCapsAction: Action = {\r\n    name: \"GET_LATEST_PUBLISHER_CAPS\",\r\n    similes: [\"FETCH_PUBLISHER_CAPS\", \"GET_PUBLISHER_LIMITS\", \"CHECK_PUBLISHER_CAPS\"],\r\n    description: \"Retrieve latest publisher caps from Pyth Network\",\r\n    examples: [[\r\n        {\r\n            user: \"user\",\r\n            content: {\r\n                text: \"Get me all the latest publisher caps\"\r\n            } as GetLatestPublisherCapsContent\r\n        } as ActionExample,\r\n        {\r\n            user: \"assistant\",\r\n            content: {\r\n                text: \"Latest publisher caps\",\r\n                success: true,\r\n                data: {\r\n                    caps: [{\r\n                        publisher: \"0x1234567890abcdef1234567890abcdef12345678\",\r\n                        cap: 1000000,\r\n                        timestamp: 1641034800\r\n                    }]\r\n                }\r\n            } as GetLatestPublisherCapsContent\r\n        } as ActionExample\r\n    ]],\r\n\r\n    validate: async (_runtime: IAgentRuntime, message: Memory): Promise<boolean> => {\r\n        // Check if this message is intended for this action\r\n        if (message.content?.type !== \"GET_LATEST_PUBLISHER_CAPS\") {\r\n            return true; // Skip validation for other actions\r\n        }\r\n\r\n        logGranular(\"Validating GET_LATEST_PUBLISHER_CAPS action\", {\r\n            content: message.content\r\n        });\r\n\r\n        try {\r\n            const content = message.content as GetLatestPublisherCapsContent;\r\n\r\n            // Use the new validation function\r\n            try {\r\n                await validatePublisherCapsData(content);\r\n                logGranular(\"Publisher caps validation passed\");\r\n            } catch (error) {\r\n                logGranular(\"Publisher caps validation failed\", { error });\r\n                if (error instanceof DataError) {\r\n                    elizaLogger.error(\"Publisher caps validation failed\", {\r\n                        errors: error.details?.errors\r\n                    });\r\n                    throw error;\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Publisher caps validation failed\",\r\n                    ErrorSeverity.HIGH,\r\n                    { error }\r\n                );\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            logGranular(\"Validation failed\", { error });\r\n            elizaLogger.error(\"Validation failed for GET_LATEST_PUBLISHER_CAPS\", {\r\n                error: error instanceof Error ? error.message : String(error)\r\n            });\r\n            return false;\r\n        }\r\n    },\r\n\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        _state?: State,\r\n        _options: { [key: string]: unknown } = {},\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        logGranular(\"Executing GET_LATEST_PUBLISHER_CAPS action\");\r\n\r\n        try {\r\n            // Get Pyth configuration\r\n            const config = await validatePythConfig(runtime);\r\n            if (!config) {\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Invalid Pyth configuration\",\r\n                    ErrorSeverity.HIGH\r\n                );\r\n            }\r\n\r\n            // Get network configuration\r\n            const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\r\n\r\n            // Initialize Hermes client\r\n            const hermesClient = new HermesClient(networkConfig.hermes);\r\n\r\n            logGranular(\"Initialized HermesClient\", {\r\n                endpoint: networkConfig.hermes\r\n            });\r\n\r\n            try {\r\n                // Get publisher caps with options\r\n                const response = await hermesClient.getLatestPublisherCaps({\r\n                    parsed: true\r\n                });\r\n\r\n                if (!response.parsed?.[0]?.publisher_stake_caps) {\r\n                    throw new DataError(\r\n                        DataErrorCode.VALIDATION_FAILED,\r\n                        \"No publisher caps data found in response\",\r\n                        ErrorSeverity.HIGH\r\n                    );\r\n                }\r\n\r\n                const publisherCaps = response.parsed[0].publisher_stake_caps;\r\n                const currentTimestamp = Date.now();\r\n\r\n                // Enhanced logging for each publisher cap\r\n                publisherCaps.forEach((cap, index) => {\r\n                    logGranular(`Publisher Cap ${index + 1}`, {\r\n                        publisher: cap.publisher,\r\n                        cap: cap.cap.toLocaleString(),\r\n                        timestamp: new Date(currentTimestamp).toLocaleString()\r\n                    });\r\n                });\r\n\r\n                logGranular(\"Successfully retrieved publisher caps\", {\r\n                    totalCaps: publisherCaps.length,\r\n                    allCaps: publisherCaps.map(cap => ({\r\n                        publisher: cap.publisher,\r\n                        cap: cap.cap.toLocaleString(),\r\n                        timestamp: new Date(currentTimestamp).toLocaleString()\r\n                    }))\r\n                });\r\n\r\n                // Format the publisher caps into text\r\n                const formattedText = publisherCaps\r\n                    .map((cap, index) =>\r\n                        `Publisher ${index + 1}:\r\nID: ${cap.publisher}\r\nCap: ${cap.cap.toLocaleString()} tokens\r\nTimestamp: ${new Date(currentTimestamp).toLocaleString()}`\r\n                    )\r\n                    .join('\\n\\n');\r\n\r\n                // Create callback content with formatted text\r\n                if (callback) {\r\n                    await callback({\r\n                        text: `Retrieved ${publisherCaps.length} publisher caps:\\n\\n${formattedText}`,\r\n                        success: true,\r\n                        data: {\r\n                            caps: publisherCaps.map(cap => ({\r\n                                publisher: cap.publisher,\r\n                                cap: cap.cap,\r\n                                timestamp: currentTimestamp\r\n                            }))\r\n                        }\r\n                    } as GetLatestPublisherCapsContent);\r\n                }\r\n\r\n                return true;\r\n            } catch (error) {\r\n                logGranular(\"Failed to process publisher caps request\", { error });\r\n                if (error instanceof DataError) {\r\n                    throw error;\r\n                }\r\n                throw new DataError(\r\n                    DataErrorCode.VALIDATION_FAILED,\r\n                    \"Failed to process publisher caps request\",\r\n                    ErrorSeverity.HIGH,\r\n                    { originalError: error }\r\n                );\r\n            }\r\n        } catch (error) {\r\n            logGranular(\"Failed to get publisher caps\", { error });\r\n            if (error instanceof DataError) {\r\n                throw error;\r\n            }\r\n            throw new DataError(\r\n                DataErrorCode.NETWORK_ERROR,\r\n                \"Failed to get publisher caps\",\r\n                ErrorSeverity.HIGH,\r\n                { originalError: error }\r\n            );\r\n        }\r\n    }\r\n};\r\n\r\nexport default getLatestPublisherCapsAction;\r\n","import type { Plugin } from \"@elizaos/core\";\r\nimport chalk from 'chalk';\r\nimport Table from 'cli-table3';\r\nimport ora from 'ora';\r\nimport getPriceFeedsAction from \"./actions/actionGetPriceFeeds\";\r\nimport getPriceUpdatesStreamAction from \"./actions/actionGetPriceUpdatesStream\";\r\nimport getLatestPriceUpdatesAction from \"./actions/actionGetLatestPriceUpdates\";\r\nimport getLatestPublisherCapsAction from \"./actions/actionGetLatestPublisherCaps\";\r\n\r\n// Start the loader\r\nconst spinner = ora({\r\n  text: chalk.cyan('Initializing Pyth Data Plugin...'),\r\n  spinner: 'dots12',\r\n  color: 'cyan'\r\n}).start();\r\n\r\n// Simulate some loading time\r\nawait new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\nconst actions = [\r\n  getPriceFeedsAction,\r\n  getPriceUpdatesStreamAction,\r\n  getLatestPriceUpdatesAction,\r\n  getLatestPublisherCapsAction,\r\n];\r\n\r\n// Initial banner with chalk styling\r\nconsole.log('\\n' + chalk.cyan(''));\r\nconsole.log(chalk.cyan('') + chalk.yellow.bold('          PYTH DATA PLUGIN             ') + chalk.cyan(' '));\r\nconsole.log(chalk.cyan(''));\r\nconsole.log(chalk.cyan('') + chalk.white('  Initializing Pyth Data Services...    ') + chalk.cyan(''));\r\nconsole.log(chalk.cyan('') + chalk.white('  Version: 1.0.0                        ') + chalk.cyan(''));\r\nconsole.log(chalk.cyan(''));\r\n\r\n// Stop the loader\r\nspinner.succeed(chalk.green('Pyth Data Plugin initialized successfully!'));\r\n\r\n// Create a beautiful table for actions\r\nconst actionTable = new Table({\r\n  head: [\r\n    chalk.cyan('Action'),\r\n    chalk.cyan('H'),\r\n    chalk.cyan('V'),\r\n    chalk.cyan('E'),\r\n    chalk.cyan('Similes')\r\n  ],\r\n  style: {\r\n    head: [],\r\n    border: ['cyan']\r\n  }\r\n});\r\n\r\n// Format and add action information\r\nactions.forEach(action => {\r\n  actionTable.push([\r\n    chalk.white(action.name),\r\n    typeof action.handler === 'function' ? chalk.green('') : chalk.red(''),\r\n    typeof action.validate === 'function' ? chalk.green('') : chalk.red(''),\r\n    action.examples?.length > 0 ? chalk.green('') : chalk.red(''),\r\n    chalk.gray(action.similes?.join(', ') || 'none')\r\n  ]);\r\n});\r\n\r\n// Display the action table\r\nconsole.log('\\n' + actionTable.toString());\r\n\r\n// Plugin status with a nice table\r\nconst statusTable = new Table({\r\n  style: {\r\n    border: ['cyan']\r\n  }\r\n});\r\n\r\nstatusTable.push(\r\n  [chalk.cyan('Plugin Status')],\r\n  [chalk.white('Name    : ') + chalk.yellow('pyth-data')],\r\n  [chalk.white('Actions : ') + chalk.green(actions.length.toString())],\r\n  [chalk.white('Status  : ') + chalk.green('Loaded & Ready')]\r\n);\r\n\r\nconsole.log('\\n' + statusTable.toString() + '\\n');\r\n\r\nconst pythDataPlugin: Plugin = {\r\n  name: \"pyth-data\",\r\n  description: \"Pyth Data Plugin for price feeds and market data\",\r\n  actions: actions,\r\n  evaluators: []\r\n};\r\n\r\n// Export for both CommonJS and ESM\r\nexport { pythDataPlugin };\r\nexport default pythDataPlugin;\r\n"]}