{"version":3,"sources":["../src/actions/transfer.ts","../src/utils/index.ts","../src/index.ts"],"sourcesContent":["import {\r\n    type ActionExample,\r\n    type HandlerCallback,\r\n    type IAgentRuntime,\r\n    type Memory,\r\n    ModelClass,\r\n    type State,\r\n    type Action,\r\n    composeContext,\r\n    generateObject,\r\n    elizaLogger,\r\n} from \"@elizaos/core\";\r\nimport {\r\n    getQuaiAccount,\r\n    isTransferContent,\r\n    validateSettings,\r\n} from \"../utils\";\r\nimport { formatUnits, type TransactionRequest } from \"quais\";\r\n\r\nconst transferTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\r\n\r\nExample response:\r\n\\`\\`\\`json\r\n{\r\n    \"tokenAddress\": \"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\r\n    \"recipient\": \"0x0005C06bD1339c79700a8DAb35DE0a1b61dFBD71\",\r\n    \"amount\": \"0.001\"\r\n}\r\n\\`\\`\\`\r\n\r\n{{recentMessages}}\r\n\r\nGiven the recent messages, extract the following information about the requested token transfer:\r\n- Token contract address (if available)\r\n- Recipient wallet address\r\n- Amount to send\r\n\r\nRespond with a JSON markdown block containing only the extracted values.`;\r\n\r\nexport default {\r\n    name: \"SEND_TOKEN\",\r\n    similes: [\r\n        \"TRANSFER_TOKEN_ON_QUAI\",\r\n        \"TRANSFER_TOKENS_ON_QUAI\",\r\n        \"SEND_TOKENS_ON_QUAI\",\r\n        \"SEND_QUAI\",\r\n        \"PAY_ON_QUAI\",\r\n    ],\r\n    // eslint-disable-next-line\r\n    validate: async (runtime: IAgentRuntime, _message: Memory) => {\r\n        return validateSettings(runtime);\r\n    },\r\n    description:\r\n        \"MUST use this action if the user requests send a token or transfer a token, the request might be varied, but it will always be a token transfer. If the user requests a transfer of lords, use this action.\",\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State,\r\n        _options: { [key: string]: unknown },\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        elizaLogger.log(\"Starting TRANSFER_TOKEN handler...\");\r\n\r\n        // Initialize or update state\r\n        const currentState = !state \r\n            ? await runtime.composeState(message) \r\n            : await runtime.updateRecentMessageState(state);\r\n\r\n        // Compose transfer context\r\n        const transferContext = composeContext({\r\n            state: currentState,\r\n            template: transferTemplate,\r\n        });\r\n\r\n        // Generate transfer content\r\n        const content = await generateObject({\r\n            runtime,\r\n            context: transferContext,\r\n            modelClass: ModelClass.MEDIUM,\r\n        });\r\n\r\n        elizaLogger.debug(\"Transfer content:\", content);\r\n\r\n        // Validate transfer content\r\n        if (!isTransferContent(content)) {\r\n            elizaLogger.error(\"Invalid content for TRANSFER_TOKEN action.\");\r\n            if (callback) {\r\n                callback({\r\n                    text: \"Not enough information to transfer tokens. Please respond with token address, recipient, and amount.\",\r\n                    content: { error: \"Invalid transfer content\" },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const account = getQuaiAccount(runtime);\r\n            const amount = formatUnits(content.amount, \"wei\");\r\n\r\n            // Declare transaction object at function scope\r\n            const txObj: TransactionRequest = content.tokenAddress \r\n                ? {} // TODO: transfer QRC20s\r\n                : {\r\n                    to: content.recipient,\r\n                    value: amount,\r\n                    from: account.address,\r\n                };\r\n\r\n            elizaLogger.log(\r\n                \"Transferring\",\r\n                amount,\r\n                \"QUAI\",\r\n                \"to\",\r\n                content.recipient\r\n            );\r\n\r\n            const tx = await account.sendTransaction(txObj);\r\n\r\n            elizaLogger.success(`Transfer completed successfully! tx: ${tx.hash}`);\r\n            if (callback) {\r\n                callback({\r\n                    text: `Transfer completed successfully! tx: ${tx.hash}`,\r\n                    content: {},\r\n                });\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error during token transfer:\", error);\r\n            if (callback) {\r\n                callback({\r\n                    text: `Error transferring tokens: ${error.message}`,\r\n                    content: { error: error.message },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"Send 10 QUAI to 0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{agent}}\",\r\n                content: {\r\n                    text: \"I'll transfer 10 QUAI to that address right away. Let me process that for you.\",\r\n                },\r\n            },\r\n        ],\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"Please send 0.5 QUAI to 0x03fe2b97c1fd336e750087d68b9b867997fd64a2661ff3ca5a7c771641e8e7ac\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{agent}}\",\r\n                content: {\r\n                    text: \"Got it, initiating transfer of 0.5 QUAI to the provided address. I'll confirm once it's complete.\",\r\n                },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;\r\n","import type { Content, IAgentRuntime } from \"@elizaos/core\";\r\nimport { JsonRpcProvider, Wallet } from \"quais\";\r\n\r\nexport const validateSettings = (runtime: IAgentRuntime) => {\r\n    const requiredSettings = [\r\n        \"QUAI_PRIVATE_KEY\",\r\n        \"QUAI_RPC_URL\",\r\n    ];\r\n\r\n    for (const setting of requiredSettings) {\r\n        if (!runtime.getSetting(setting)) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nexport const getQuaiProvider = (runtime: IAgentRuntime) => {\r\n    return new JsonRpcProvider(\r\n        runtime.getSetting(\"QUAI_RPC_URL\"),\r\n    );\r\n};\r\n\r\nexport const getQuaiAccount = (runtime: IAgentRuntime) => {\r\n    const provider = getQuaiProvider(runtime);\r\n    const account = new Wallet(runtime.getSetting(\"QUAI_PRIVATE_KEY\"), provider);\r\n    return account;\r\n};\r\n\r\nexport interface TransferContent extends Content {\r\n    tokenAddress: string;\r\n    recipient: string;\r\n    amount: string | number;\r\n}\r\n\r\nexport function isTransferContent(\r\n    content: unknown\r\n): content is TransferContent {\r\n    if (!content || typeof content !== 'object') {\r\n        return false;\r\n    }\r\n    \r\n    const contentObj = content as { tokenAddress?: unknown; recipient?: unknown; amount?: unknown };\r\n    \r\n    // Validate types\r\n    const validTypes =\r\n        (contentObj.tokenAddress === null || typeof contentObj.tokenAddress === \"string\") &&\r\n        typeof contentObj.recipient === \"string\" &&\r\n        (typeof contentObj.amount === \"string\" ||\r\n            typeof contentObj.amount === \"number\");\r\n    if (!validTypes) {\r\n        return false;\r\n    }\r\n\r\n    // Validate addresses (20-bytes with 0x prefix)\r\n    const recipient = contentObj.recipient as string;\r\n    const tokenAddress = contentObj.tokenAddress as string | null;\r\n\r\n    const validRecipient =\r\n        recipient.startsWith(\"0x\") &&\r\n        recipient.length === 42;\r\n\r\n    // If tokenAddress is provided, validate it\r\n    const validTokenAddress = tokenAddress === null ||\r\n        (tokenAddress.startsWith(\"0x\") &&\r\n        tokenAddress.length === 42);\r\n\r\n    return validRecipient && validTokenAddress;\r\n}\r\n\r\n// export function isTransferContent(\r\n//     content: any\r\n// ): content is TransferContent {\r\n//     // Validate types\r\n//     const validTypes =\r\n//         (content.tokenAddress === null || typeof content.tokenAddress === \"string\") &&\r\n//         typeof content.recipient === \"string\" &&\r\n//         (typeof content.amount === \"string\" ||\r\n//             typeof content.amount === \"number\");\r\n//     if (!validTypes) {\r\n//         return false;\r\n//     }\r\n\r\n//     // Validate addresses (20-bytes with 0x prefix)\r\n//     const validRecipient =\r\n//         content.recipient.startsWith(\"0x\") &&\r\n//         content.recipient.length === 42;\r\n\r\n//     // If tokenAddress is provided, validate it\r\n//     const validTokenAddress = content.tokenAddress === null ||\r\n//         (content.tokenAddress.startsWith(\"0x\") &&\r\n//         content.tokenAddress.length === 42);\r\n\r\n//     return validRecipient && validTokenAddress;\r\n\r\n","import type { Plugin } from \"@elizaos/core\";\r\nimport transfer from \"./actions/transfer\";\r\n\r\nexport const quaiPlugin: Plugin = {\r\n    name: \"quai\",\r\n    description: \"Quai Plugin for Eliza\",\r\n    actions: [transfer],\r\n    evaluators: [],\r\n    providers: [],\r\n};\r\n\r\nexport default quaiPlugin;\r\n"],"mappings":"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","names":[]}