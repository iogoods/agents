{"version":3,"sources":["../src/actions/news.ts","../src/index.ts"],"sourcesContent":["import {\r\n    ActionExample,\r\n    Content,\r\n    generateText,\r\n    HandlerCallback,\r\n    IAgentRuntime,\r\n    Memory,\r\n    ModelClass,\r\n    State,\r\n    type Action,\r\n} from \"@elizaos/core\";\r\n\r\n\r\nexport const currentNewsAction: Action = {\r\n    name: \"CURRENT_NEWS\",\r\n    similes: [\"NEWS\", \"GET_NEWS\", \"GET_CURRENT_NEWS\"],\r\n    validate: async (_runtime: IAgentRuntime, _message: Memory) => {\r\n        const apiKey = process.env.NEWS_API_KEY;\r\n        if (!apiKey) {\r\n            throw new Error('NEWS_API_KEY environment variable is not set');\r\n        }\r\n        return true;\r\n    },\r\n    description:\r\n        \"Get the latest news about a specific topic if asked by the user.\",\r\n    handler: async (\r\n        _runtime: IAgentRuntime,\r\n        _message: Memory,\r\n        _state: State,\r\n        _options: { [key: string]: unknown; },\r\n        _callback: HandlerCallback,\r\n    ): Promise<boolean> => {\r\n        async function getCurrentNews(searchTerm: string) {\r\n            try {\r\n                const enhancedSearchTerm = encodeURIComponent(`\"${searchTerm}\" AND (Spain OR Spanish OR Madrid OR Felipe)`);\r\n\r\n                const [everythingResponse, headlinesResponse] = await Promise.all([\r\n                    fetch(\r\n                        `https://newsapi.org/v2/everything?q=${enhancedSearchTerm}&sortBy=relevancy&language=en&pageSize=50&apiKey=${process.env.NEWS_API_KEY}`\r\n                    ),\r\n                    fetch(\r\n                        `https://newsapi.org/v2/top-headlines?q=${searchTerm}&country=es&language=en&pageSize=50&apiKey=${process.env.NEWS_API_KEY}`\r\n                    )\r\n                ]);\r\n\r\n                const [everythingData, headlinesData] = await Promise.all([\r\n                    everythingResponse.json(),\r\n                    headlinesResponse.json()\r\n                ]);\r\n\r\n                // Combine and filter articles\r\n                const allArticles = [\r\n                    ...(headlinesData.articles || []),\r\n                    ...(everythingData.articles || [])\r\n                ].filter(article =>\r\n                    article.title &&\r\n                    article.description &&\r\n                    (article.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                     article.description.toLowerCase().includes(searchTerm.toLowerCase()))\r\n                );\r\n\r\n                // Remove duplicates and get up to 15 articles\r\n                const uniqueArticles = Array.from(\r\n                    new Map(allArticles.map(article => [article.title, article])).values()\r\n                ).slice(0, 15);\r\n\r\n                if (!uniqueArticles.length) {\r\n                    return \"No news articles found.\";\r\n                }\r\n\r\n                return uniqueArticles.map((article, index) => {\r\n                    const content = article.description || 'No content available';\r\n                    const urlDomain = article.url ? new URL(article.url).hostname : '';\r\n                    return [\r\n                        `üì∞ Article ${index + 1}`,\r\n                        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',\r\n                        `üìå **${article.title || 'No title'}**\\n`,\r\n                        `üìù ${content}\\n`,\r\n                        `üîó Read more at: ${urlDomain}`\r\n                    ].join('\\n');\r\n                }).join('\\n');\r\n            } catch (error) {\r\n                console.error('Failed to fetch news:', error);\r\n                return 'Sorry, there was an error fetching the news.';\r\n            }\r\n        }\r\n\r\n        const context = `What is the specific topic or subject the user wants news about? Extract ONLY the search term from this message: \"${_message.content.text}\". Return just the search term with no additional text, punctuation, or explanation.`\r\n\r\n        const searchTerm = await generateText({\r\n            runtime: _runtime,\r\n            context,\r\n            modelClass: ModelClass.SMALL,\r\n            stop: [\"\\n\"],\r\n        });\r\n\r\n        // For debugging\r\n        console.log(\"Search term extracted:\", searchTerm);\r\n\r\n        const currentNews = await getCurrentNews(searchTerm);\r\n        const responseText = ` *protocol droid noises*\\n\\n${currentNews}`;\r\n\r\n\r\n        const newMemory: Memory = {\r\n            userId: _message.agentId,\r\n            agentId: _message.agentId,\r\n            roomId: _message.roomId,\r\n            content: {\r\n                text: responseText,\r\n                action: \"CURRENT_NEWS_RESPONSE\",\r\n                source: _message.content?.source,\r\n            } as Content,\r\n        };\r\n\r\n        await _runtime.messageManager.createMemory(newMemory);\r\n\r\n        _callback(newMemory.content);\r\n        return true;\r\n\r\n    },\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"what's the latest news about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"can you show me the latest news about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"what's in the <searchTerm> news today?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"show me current events about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"what's going on in the world of <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"give me the latest headlines about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"show me news updates about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: { text: \"what are today's top stories about <searchTerm>?\" },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: { text: \"\", action: \"CURRENT NEWS\" },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;","import { Plugin } from \"@elizaos/core\";\r\nimport { currentNewsAction } from \"./actions/news\";\r\n\r\nexport const newsPlugin: Plugin = {\r\n    name: \"newsPlugin\",\r\n    description: \"Get the latest news about a specific topic if asked by the user.\",\r\n    actions: [currentNewsAction],\r\n};\r\n\r\nexport default newsPlugin;\r\n"],"mappings":"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","names":["searchTerm"]}