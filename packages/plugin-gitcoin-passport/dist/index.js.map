{"version":3,"sources":["../src/actions/getScore.ts","../src/index.ts"],"sourcesContent":["import {\r\n    type Action,\r\n    elizaLogger,\r\n    type IAgentRuntime,\r\n    type Memory,\r\n    type HandlerCallback,\r\n    type State,\r\n    getEmbeddingZeroVector,\r\n    composeContext,\r\n    generateMessageResponse,\r\n    ModelClass,\r\n} from \"@elizaos/core\";\r\n\r\ninterface PassportScore {\r\n    address: string;\r\n    score: string;\r\n    threshold: string;\r\n    passing_score: string;\r\n}\r\n\r\nconst createTokenMemory = async (\r\n    runtime: IAgentRuntime,\r\n    _message: Memory,\r\n    formattedOutput: string\r\n) => {\r\n    const memory: Memory = {\r\n        userId: _message.userId,\r\n        agentId: _message.agentId,\r\n        roomId: _message.roomId,\r\n        content: { text: formattedOutput },\r\n        createdAt: Date.now(),\r\n        embedding: getEmbeddingZeroVector(),\r\n    };\r\n    await runtime.messageManager.createMemory(memory);\r\n};\r\n\r\nexport const addressTemplate = `From previous sentence extract only the Ethereum address being asked about.\r\nRespond with a JSON markdown block containing only the extracted value:\r\n\r\n\\`\\`\\`json\r\n{\r\n\"address\": string | null\r\n}\r\n\\`\\`\\`\r\n`;\r\n\r\nexport const getPassportScoreAction: Action = {\r\n    name: \"GET_PASSPORT_SCORE\",\r\n    description: \"Get score from Passport API for an address\",\r\n    validate: async (runtime: IAgentRuntime, _message: Memory) => {\r\n        elizaLogger.log(\"Validating runtime for GET_PASSPORT_SCORE...\");\r\n        const apiKey = runtime.getSetting(\"PASSPORT_API_KEY\");\r\n        const scorerId = runtime.getSetting(\"PASSPORT_SCORER\");\r\n        if (!apiKey || !scorerId) {\r\n            elizaLogger.error(\r\n                \"Missing PASSPORT_API_KEY or PASSPORT_SCORER settings\"\r\n            );\r\n            return false;\r\n        }\r\n        return true;\r\n    },\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        _message: Memory,\r\n        state: State,\r\n        _options: Record<string, unknown>,\r\n        callback: HandlerCallback\r\n    ) => {\r\n        elizaLogger.log(\"Starting GET_PASSPORT_SCORE handler...\");\r\n        const apiKey = runtime.getSetting(\"PASSPORT_API_KEY\");\r\n        const scorerId = runtime.getSetting(\"PASSPORT_SCORER\");\r\n\r\n        // Initialize or update state\r\n        let currentState = state;\r\n        if (!currentState) {\r\n            currentState = (await runtime.composeState(_message)) as State;\r\n        } else {\r\n            currentState = await runtime.updateRecentMessageState(currentState);\r\n        }\r\n\r\n        const context = composeContext({\r\n            state: currentState,\r\n            template: `${_message.content.text}\\n${addressTemplate}`,\r\n        });\r\n\r\n        const addressRequest = await generateMessageResponse({\r\n            runtime,\r\n            context,\r\n            modelClass: ModelClass.SMALL,\r\n        });\r\n\r\n        const address = addressRequest.address as string;\r\n\r\n        if (!address) {\r\n            callback({ text: \"Address is required.\" }, []);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(\r\n                `https://api.passport.xyz/v2/stamps/${scorerId}/score/${address}`,\r\n                {\r\n                    method: \"GET\",\r\n                    headers: {\r\n                        \"X-API-KEY\": apiKey,\r\n                        accept: \"application/json\",\r\n                    },\r\n                }\r\n            );\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error! status: ${response.status}`);\r\n            }\r\n\r\n            const data: PassportScore = await response.json();\r\n            const formattedOutput = `Address: ${data.address}\\nScore: ${data.score}${data.passing_score ? \"\\nScore is above threshold\" : `\\nScore is below threshold (${data.threshold})`}`;\r\n\r\n            await createTokenMemory(runtime, _message, formattedOutput);\r\n\r\n            callback({ text: formattedOutput }, []);\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error fetching Passport score:\", error);\r\n            callback(\r\n                {\r\n                    text: \"Failed to fetch Passport score. Please check the logs for more details.\",\r\n                },\r\n                []\r\n            );\r\n        }\r\n    },\r\n    examples: [],\r\n    similes: [\r\n        \"GET_PASSPORT_SCORE\",\r\n        \"FETCH_PASSPORT_SCORE\",\r\n        \"CHECK_PASSPORT_SCORE\",\r\n        \"VIEW_PASSPORT_SCORE\",\r\n    ],\r\n};\r\n","export * from \"./actions/getScore\";\r\n\r\nimport type { Plugin } from \"@elizaos/core\";\r\nimport { getPassportScoreAction } from \"./actions/getScore\";\r\n\r\nexport const gitcoinPassportPlugin: Plugin = {\r\n    name: \"passport\",\r\n    description: \"Gitcoin passport integration plugin\",\r\n    providers: [],\r\n    evaluators: [],\r\n    services: [],\r\n    actions: [getPassportScoreAction],\r\n};\r\n\r\nexport default gitcoinPassportPlugin;\r\n"],"mappings":"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","names":[]}